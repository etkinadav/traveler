<div class="fill-height px-2 pb-2 d-flex justify-content-center px-lg-5">
  <section class="w-100 d-flex flex-column">
    
    <!-- Title -->
    <div class="w-100 d-flex justify-content-between align-items-center px-2 pt-1 pb-3 p-lg-3">
      <h6 class="mb-0 zx-text-medium fw-bold zx-text-sm-big">
        {{ 'translator.title' | translate }}
      </h6>
    </div>

    <!-- Language Selectors -->
    <div class="w-100 px-2 pb-3 px-lg-3">
      <div class="row g-3">
        <!-- Speaker A Language -->
        <div class="col-12 col-md-6">
          <div class="position-relative">
            <button 
              mat-stroked-button 
              (click)="showLanguageSelectorA = !showLanguageSelectorA"
              class="w-100 d-flex justify-content-between align-items-center"
              [class.speaker-a]="true">
              <span>
                <strong>{{ 'translator.speaker-a' | translate }}:</strong> {{ getSelectedLanguageNameA() }}
              </span>
              <mat-icon>{{ showLanguageSelectorA ? 'expand_less' : 'expand_more' }}</mat-icon>
            </button>

            <!-- Language Dropdown A -->
            <div 
              *ngIf="showLanguageSelectorA" 
              class="language-selector-dropdown"
              [class.rtl]="isRTL">
              <div class="p-2">
                <mat-form-field class="w-100">
                  <mat-label>{{ 'translator.search-language' | translate }}</mat-label>
                  <input 
                    matInput 
                    [(ngModel)]="languageSearchTermA"
                    (input)="filterLanguagesA()"
                    [placeholder]="'translator.search-language-placeholder' | translate">
                  <mat-icon matPrefix>search</mat-icon>
                </mat-form-field>
              </div>
              <div class="language-list">
                <div 
                  *ngFor="let lang of filteredLanguagesA"
                  [class.selected]="selectedLanguageA === lang.code"
                  (click)="onLanguageChangeA(lang.code)"
                  class="language-item">
                  <div class="d-flex flex-column">
                    <span class="fw-bold">{{ lang.nativeName }}</span>
                    <span class="text-muted small">{{ lang.name }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Speaker B Language -->
        <div class="col-12 col-md-6">
          <div class="position-relative">
            <button 
              mat-stroked-button 
              (click)="showLanguageSelectorB = !showLanguageSelectorB"
              class="w-100 d-flex justify-content-between align-items-center"
              [class.speaker-b]="true">
              <span>
                <strong>{{ 'translator.speaker-b' | translate }}:</strong> {{ getSelectedLanguageNameB() }}
              </span>
              <mat-icon>{{ showLanguageSelectorB ? 'expand_less' : 'expand_more' }}</mat-icon>
            </button>

            <!-- Language Dropdown B -->
            <div 
              *ngIf="showLanguageSelectorB" 
              class="language-selector-dropdown"
              [class.rtl]="isRTL">
              <div class="p-2">
                <mat-form-field class="w-100">
                  <mat-label>{{ 'translator.search-language' | translate }}</mat-label>
                  <input 
                    matInput 
                    [(ngModel)]="languageSearchTermB"
                    (input)="filterLanguagesB()"
                    [placeholder]="'translator.search-language-placeholder' | translate">
                  <mat-icon matPrefix>search</mat-icon>
                </mat-form-field>
              </div>
              <div class="language-list">
                <div 
                  *ngFor="let lang of filteredLanguagesB"
                  [class.selected]="selectedLanguageB === lang.code"
                  (click)="onLanguageChangeB(lang.code)"
                  class="language-item">
                  <div class="d-flex flex-column">
                    <span class="fw-bold">{{ lang.nativeName }}</span>
                    <span class="text-muted small">{{ lang.name }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="w-100 px-2 pb-3 px-lg-3">
      <mat-card class="error-card">
        <mat-card-content>
          <div class="d-flex align-items-center">
            <mat-icon color="warn" class="me-2">error</mat-icon>
            <span>{{ errorMessage }}</span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Main Control Area -->
    <div class="w-100 d-flex flex-column align-items-center px-2 pb-3 px-lg-3">
      
      <!-- Microphone Button -->
      <button 
        mat-fab 
        [color]="getStatusColor()"
        [class.listening]="isListening"
        (click)="toggleListening()"
        [disabled]="status === 'error'"
        class="microphone-button mb-4">
        <mat-icon>{{ getStatusIcon() }}</mat-icon>
      </button>

      <!-- Status Indicator -->
      <div class="status-indicator mb-3">
        <span *ngIf="status === 'listening'" class="listening-dot"></span>
        <span class="status-text">
          <span *ngIf="status === 'listening' && currentSpeaker">
            {{ 'translator.status-listening' | translate }} - {{ getSpeakerName(currentSpeaker) }}
          </span>
          <span *ngIf="status === 'listening' && !currentSpeaker">{{ 'translator.status-listening' | translate }}</span>
          <span *ngIf="status === 'stopped'">{{ 'translator.status-stopped' | translate }}</span>
          <span *ngIf="status === 'idle'">{{ 'translator.status-ready' | translate }}</span>
        </span>
      </div>

      <!-- Transcript Area -->
      <mat-card class="transcript-card w-100">
        <mat-card-content>
          <div class="transcript-header d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">{{ 'translator.transcript' | translate }}</h6>
            <div class="transcript-actions">
              <button 
                mat-icon-button 
                (click)="copyToClipboard()"
                [disabled]="!transcript"
                matTooltip="{{ 'translator.copy' | translate }}">
                <mat-icon>content_copy</mat-icon>
              </button>
              <button 
                mat-icon-button 
                (click)="clearTranscript()"
                [disabled]="!transcript"
                matTooltip="{{ 'translator.clear' | translate }}">
                <mat-icon>clear</mat-icon>
              </button>
            </div>
          </div>
          <div 
            class="transcript-content"
            [class.interim]="status === 'listening' && transcript && !transcriptHistory.length">
            <div *ngIf="transcript; else emptyState" [dir]="isRTL ? 'rtl' : 'ltr'">
              <div *ngIf="currentSpeaker" class="current-speaker-indicator mb-2">
                <span class="speaker-badge" [class.speaker-a-badge]="currentSpeaker === 'A'" [class.speaker-b-badge]="currentSpeaker === 'B'">
                  {{ getSpeakerName(currentSpeaker) }}:
                </span>
              </div>
              <p class="mb-0">{{ transcript }}</p>
            </div>
            <ng-template #emptyState>
              <p class="text-muted text-center">
                {{ 'translator.transcript-placeholder' | translate }}
              </p>
            </ng-template>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- History (if exists) -->
      <div *ngIf="transcriptHistory.length > 0" class="w-100 mt-3">
        <mat-card>
          <mat-card-header>
            <mat-card-title>{{ 'translator.history' | translate }}</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="history-list play-style">
              <div 
                *ngFor="let item of transcriptHistory"
                class="history-item play-item"
                [class.speaker-a-item]="item.speaker === 'A'"
                [class.speaker-b-item]="item.speaker === 'B'"
                [dir]="isRTL ? 'rtl' : 'ltr'">
                <div class="speaker-label">
                  <span class="speaker-badge" [class.speaker-a-badge]="item.speaker === 'A'" [class.speaker-b-badge]="item.speaker === 'B'">
                    {{ getSpeakerName(item.speaker) }}:
                  </span>
                </div>
                <div class="speaker-text">
                  {{ item.text }}
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

    </div>

  </section>
</div>

