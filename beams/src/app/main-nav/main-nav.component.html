<!-- NavBar 拽注 注  -->
<mat-toolbar [ngClass]="{'transparent-toolbar': isHomePage()}" 
             style="position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; z-index: 1000 !important;"
             [class.zx-100-opp]="isRootScreen">

    <button class="custom-hamburger-btn" [class.open]="isHamburgerOpen" type="button" aria-label="Toggle sidenav"
      (click)="toggleDrawer()" 
      (mouseenter)="onHamburgerHover()" 
      (mouseleave)="onHamburgerLeave()">
      <div class="hamburger-lines">
        <div class="hamburger-line" 
             [class.hovered]="isHamburgerHovered && !isHamburgerOpen"
             [class.open]="isHamburgerOpen"></div>
        <div class="hamburger-line" 
             [class.hovered]="isHamburgerHovered && !isHamburgerOpen"
             [class.open]="isHamburgerOpen"></div>
        <div class="hamburger-line" 
             [class.hovered]="isHamburgerHovered && !isHamburgerOpen"
             [class.open]="isHamburgerOpen"></div>
      </div>
    </button>

    <span class="spacer"></span>

    <div (click)="goToHome()"
      class="d-flex align-items-center justify-content-center">
      <img *ngIf="userName !== ''" src="assets/images/logo/ondi-logo-small.png" alt="OnDi Logo"
        class="ondi-logo-small-mobile c-pointer">
      <img *ngIf="userName !== ''" src="assets/images/logo/ondi-logo.png" alt="OnDi Logo"
        class="ondi-logo-desktop c-pointer">
      <img *ngIf="userName === ''" src="assets/images/logo/ondi-logo-small.png" alt="OnDi Logo"
        class="ondi-logo-small-mobile c-pointer">
      <img *ngIf="userName === ''" src="assets/images/logo/ondi-logo.png" alt="OnDi Logo"
        class="ondi-logo-desktop c-pointer">
    </div>

    <span class="spacer"></span>

    <!-- 驻转专 砖拽 砖 注抓 -->
    <button class="guess-tree-btn" (click)="goToGuessTree()" title="砖拽 砖 注抓">
      
    </button>

    <div class="d-flex align-items-center gap-2 h-100">



      <div class="h-100 d-flex align-items-center">

        <button *ngIf="userName === '' && !isLoggedOutLoading" type="button" mat-stroked-button color="primary"
          class="zx-login-btn text-primary rounded-2" (click)="openLoginDialog()">
          {{'main-nav.log-in' | translate}}
        </button>

        <div *ngIf="userName !== ''" class="h-100 d-flex align-items-center c-pointer">
          <div class="h-100 d-flex align-items-center c-pointer" (click)="toggleProfileManu()">
            <!-- 抓 转 砖转 -->
            <div class="custom-arrow" [class.open]="isProManuOpen">
              <div class="arrow-line"></div>
              <div class="arrow-line"></div>
            </div>
            <a type="button" color="primary" class="profile-image-container">
              <img class="svg zx-profile-default" [src]="getUserProfileImg(user)"
                alt="Default Profile Image">
            </a>
          </div>
          <div class="overlay-manu" *ngIf="isProManuOpen" (click)="closeProfileManu()"></div>
          <div class="position-absolute" *ngIf="isProManuOpen">
            <div class="position-relative">
              <div class="zx-profile-manu rounded-3 step-item" [class.zx-profile-manu-rtl]="isRTL"
                [class.zx-profile-manu-dark]="isDarkMode">

                <!-- 注转 专 专 砖转砖 -->
                <div class="user-greeting-bubble" [class.zx-rtl]="isRTL">
                  <div class="speech-bubble">
                    <div class="greeting-text">{{ 'main-nav.greeting.' + greeting | translate }}, {{ getEmailWithoutDomain(userName) }} ;)</div>
                    
                    <!-- 抓 驻专 注 class 砖 -->
                    <div class="arrow-container">
                      <div class="speech-arrow"></div>
                    </div>
                  </div>
                </div>

                <!--  驻转专 注 专 拽注 -->
                <div class="menu-buttons-container">
                  <button *ngIf="userIsAuthenticated" class="justify-content-start d-sm-none" mat-menu-item
                    (click)="goToMyOrders()">
                    <div class="d-flex align-items-center justify-content-center gap-2">
                      <span class="mat-list-item-small" [class.fw-bold]="userIsAuthenticated && numOfPendingOrders > 0"
                        [class.num-pending-text]="userIsAuthenticated && numOfPendingOrders > 0 && !isDarkMode">
                        {{'main-nav.my-orders' | translate }}
                      </span>
                      <span class="num-pending-con" [class.num-pending-con-not-rtl]="!isRTL"
                        *ngIf="userIsAuthenticated && numOfPendingOrders > 0">
                        <span class="num-pending">
                          {{ numOfPendingOrders < 9 ? numOfPendingOrders : '9+' }} </span>
                        </span>
                    </div>
                  </button>

                  <button class="justify-content-start rounded-sm-top-3" mat-menu-item (click)="goToMyProfile()">
                    <span class="mat-list-item-small">
                      {{'main-nav.my-profile' | translate}}
                    </span>
                  </button>

                  <button class="justify-content-start" mat-menu-item (click)="goToMyProfileCreditMode()">
                    <span class="mat-list-item-small">
                      {{'main-nav.methods-of-payment' | translate}}
                    </span>
                  </button>

                  <!-- 拽 驻专 专拽 注 转转拽转 -->
                  <hr class="menu-separator">

                  <button class="justify-content-start rounded-bottom-3" mat-menu-item (click)="onLogout()">
                    <span class="mat-list-item-small" [class.zx-text-warn]="!isDarkMode">
                      {{'main-nav.logout' | translate}}
                    </span>
                  </button>
                </div>

              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
</mat-toolbar>

<mat-sidenav-container>
  <mat-sidenav #drawer class="sidenav" mode="over" [(opened)]="isDrawerOpen" (closed)="onDrawerClosed()">

    <mat-nav-list class="d-flex flex-column vh-100 pb-5">

      <div class="d-sm-none w-100 zx-border-gray-top-v-v-light my-1" [class.zx-low-opp]="isDarkMode"></div>

      <!-- 注转 拽转 - 砖 驻 砖转 转砖转 -->
      <a mat-list-item (click)="openCartDialog(); closeDrawer()">
        <div class="d-flex align-items-center gap-2">
          <mat-icon style="color: var(--zx-green) !important;">shopping_cart</mat-icon>
          <span class="mat-list-item-small" style="color: var(--zx-green) !important; font-size: 13px !important; font-weight: 600 !important;">
            注转 拽转
          </span>
          <span *ngIf="cartItemsCount > 0" style="width: 6.5px; display: inline-block; margin-left: -8px;"></span>
          <span *ngIf="cartItemsCount > 0" class="cart-counter-badge" style="color: white !important; background-color: #007bff !important;">
            {{ cartItemsCount }}
          </span>
        </div>
      </a>

      <div class="w-100 zx-border-gray-top-v-v-light my-1" [class.zx-low-opp]="isDarkMode"></div>

      <a mat-list-item (click)="goToQAndA()">
        <span class="mat-list-item-small" style="color: var(--zx-green) !important; font-size: 13px !important; font-weight: 600 !important;">
          {{ 'main-nav.q-and-a' | translate }}
        </span>
      </a>

      <div class="w-100 zx-border-gray-top-v-v-light my-1" [class.zx-low-opp]="isDarkMode"></div>

      <a mat-list-item (click)="openWhatsApp()">
        <div class="w-100 h-100 d-flex align-items-center gap-2">
          <div class="whatsup-logo-container">
            <img src="assets/images/whatsup-logo.svg" alt="WhatsUp Logo" class="whatsup-logo">
          </div>
          <span class="mat-list-item-small" style="color: var(--zx-green) !important; font-size: 13px !important; font-weight: 600 !important;">
            {{'main-nav.contact-us' | translate}}
          </span>
        </div>
      </a>

      <div class="w-100 zx-border-gray-top-v-v-light my-1" [class.zx-low-opp]="isDarkMode"></div>


      <!-- // -->
      <div *ngIf="isSU" class="w-100 zx-border-gray-top-v-v-light my-1" [class.zx-low-opp]="isDarkMode"></div>

      <!-- Super Managment Mode -->
      <a *ngIf="isSU" mat-list-item aria-label="Super Managment" [matMenuTriggerFor]="superManigmentMode">
        <span class="mat-list-item-small">
          {{'main-nav.super-management-mode' | translate}}
        </span>
      </a>
      <mat-menu #superManigmentMode="matMenu" style="width: 250px;">

        <!-- printer -->
        <button class="d-flex align-items-center gap-1 px-2" [class.zx-ltr]="!isRTL" mat-menu-item
          (click)="goToManagementPage('printer')">
          <b class="zx-text-small m-0" [class.zx-text-white]="isDarkMode">
            {{ 'su-management.printer-management' | translate }}
          </b>
          <mat-icon class="mx-1 p-0 zx-pt-small" [class.zx-text-white]="isDarkMode">print</mat-icon>
        </button>
        <!-- orders -->
        <button class="d-flex align-items-center gap-1 px-2" [class.zx-ltr]="!isRTL" mat-menu-item
          (click)="goToManagementPage('orders')">
          <b class="zx-text-small m-0" [class.zx-text-white]="isDarkMode">
            {{ 'su-management.orders-management' | translate }}
          </b>
          <mat-icon class="mx-1 p-0 zx-pt-small" [class.zx-text-white]="isDarkMode">assignment</mat-icon>
        </button>
        <!-- users -->
        <button class="d-flex align-items-center gap-1 px-2" [class.zx-ltr]="!isRTL" mat-menu-item
          (click)="goToManagementPage('users')">
          <b class="zx-text-small m-0" [class.zx-text-white]="isDarkMode">
            {{ 'su-management.users-management' | translate }}
          </b>
          <mat-icon class="mx-1 p-0 zx-pt-small" [class.zx-text-white]="isDarkMode">supervisor_account</mat-icon>
        </button>
        <!-- inventory -->
        <button class="d-flex align-items-center gap-1 px-2" [class.zx-ltr]="!isRTL" mat-menu-item
          (click)="goToManagementPage('inventory')">
          <b class="zx-text-small m-0" [class.zx-text-white]="isDarkMode">
            {{ 'su-management.inventory-management' | translate }}
          </b>
          <mat-icon class="mx-1 p-0 zx-pt-small" [class.zx-text-white]="isDarkMode">ballot</mat-icon>
        </button>
        <!-- branch -->
        <button class="d-flex align-items-center gap-1 px-2" [class.zx-ltr]="!isRTL" mat-menu-item
          (click)="goToManagementPage('branch')">
          <b class="zx-text-small m-0" [class.zx-text-white]="isDarkMode">
            {{ 'su-management.branch-management' | translate }}
          </b>
          <mat-icon class="mx-1 p-0 zx-pt-small" [class.zx-text-white]="isDarkMode">how_to_reg</mat-icon>
        </button>
        <!-- report -->
        <button class="d-flex align-items-center gap-1 px-2" [class.zx-ltr]="!isRTL" mat-menu-item
          (click)="goToManagementPage('report')">
          <b class="zx-text-small m-0" [class.zx-text-white]="isDarkMode">
            {{ 'su-management.report-management' | translate }}
          </b>
          <mat-icon class="mx-1 p-0 zx-pt-small" [class.zx-text-white]="isDarkMode">equalizer</mat-icon>
        </button>

        <!-- branches -->
        <!-- <div class="d-flex p-2" [class.justify-content-end]="!isRTL">
          <u>
            {{'main-nav.super-management-branches' | translate}}
          </u>
        </div>
        <div class="d-flex" [class.flex-row-reverse]="!isRTL">
          <button class="mat-list-item-small centered-text" mat-menu-item (click)="goToBranchList()">
            <span class="zx-text-small centered-text">
              {{'choose-system.title-short-plotter' | translate}}
            </span>
          </button>
          <button class="mat-list-item-small centered-text" mat-menu-item>
            <span class="zx-text-small centered-text">
              {{'choose-system.title-short-express' | translate}}
            </span>
          </button>
        </div> -->

        <!-- users -->
        <!-- <div class="d-flex p-2" [class.justify-content-end]="!isRTL">
          <u>
            {{'main-nav.super-management-users' | translate}}
          </u>
        </div>
        <div class="d-flex" [class.flex-row-reverse]="!isRTL">
          <button class="mat-list-item-small centered-text" mat-menu-item (click)="goToUserList()">
            <span class="zx-text-small centered-text">{{'choose-system.title-short-plotter' | translate}}</span>
          </button>
          <button class="mat-list-item-small centered-text" mat-menu-item>
            <span class="zx-text-small centered-text">
              {{'choose-system.title-short-express' | translate}}
            </span>
          </button>
        </div> -->

        <!-- papers -->
        <!-- <div class="d-flex p-2" [class.justify-content-end]="!isRTL">
          <u>{{'main-nav.super-management-papers' | translate}}</u>
        </div>
        <div class="d-flex" [class.flex-row-reverse]="!isRTL">
          <button class="mat-list-item-small centered-text" mat-menu-item (click)="goToPaperList()">
            <span class="zx-text-small centered-text">
              {{'choose-system.title-short-plotter' | translate}}
            </span>
          </button>
          <button class="mat-list-item-small centered-text" mat-menu-item>
            <span class="zx-text-small centered-text">
              {{'choose-system.title-short-express' | translate}}
            </span>
          </button>
        </div> -->

        <!-- back to user mode -->
        <!-- <hr>
        <button mat-menu-item (click)="goToHome()" [class.justify-content-end]="!isRTL">
          <span class="mat-list-item-small text-green">
            {{'main-nav.user-mode' | translate}}
          </span>
        </button> -->
      </mat-menu>

      <!--  Set language  + Set Theme + Terms of Use + Privacy Policy -->
      
      <!-- Set language -->
      <a mat-list-item aria-label="Set language" [matMenuTriggerFor]="menuLanguage">
        <div class="w-100 h-100 d-flex align-items-center gap-2">
          <mat-icon style="color: var(--zx-green) !important;">language</mat-icon>
          <span class="mat-list-item-small" style="color: var(--zx-green) !important; font-size: 13px !important; font-weight: 600 !important;">Language</span>
        </div>
      </a>
      <mat-menu #menuLanguage="matMenu">
        <button mat-menu-item (click)="goToLanguage('he')" [class.justify-content-end]="!isRTL">
          <span class="mat-list-item-small">注专转</span>
        </button>
        <button mat-menu-item (click)="goToLanguage('en')" [class.justify-content-end]="!isRTL">
          <span class="mat-list-item-small">English</span>
        </button>
        <button mat-menu-item (click)="goToLanguage('ar')" [class.justify-content-end]="!isRTL">
          <span class="mat-list-item-small">丕毓乇亘丞</span>
        </button>
      </mat-menu>

      <div class="w-100 zx-border-gray-top-v-v-light my-1" [class.zx-low-opp]="isDarkMode"></div>

      <!-- Set Theme -->
      <a mat-list-item aria-label="Set Theme" [matMenuTriggerFor]="menuTheme">
        <div class="w-100 h-100 d-flex align-items-center gap-2">
          <mat-icon style="color: var(--zx-green) !important;">
            {{ isDarkTheme ? 'brightness_7' : 'brightness_4' }}
          </mat-icon>
          <span class="mat-list-item-small" style="color: var(--zx-green) !important; font-size: 13px !important; font-weight: 600 !important;">
            {{'main-nav.mode' | translate}}
          </span>
        </div>
      </a>
      <mat-menu #menuTheme="matMenu">
        <button mat-menu-item (click)="changeTheme('light')" [class.justify-content-end]="!isRTL">
          <span class="mat-list-item-small">{{'main-nav.light-mode' | translate}}</span>
        </button>
        <button mat-menu-item (click)="changeTheme('dark')" [class.justify-content-end]="!isRTL">
          <span class="mat-list-item-small">{{'main-nav.dark-mode' | translate}}</span>
        </button>
      </mat-menu>

      <div class="w-100 zx-border-gray-top-v-v-light my-1" [class.zx-low-opp]="isDarkMode"></div>

      <!-- Terms of Use -->
      <a mat-list-item (click)="goToTandC()">
        <span class="mat-list-item-small" style="color: var(--zx-green) !important; font-size: 13px !important; font-weight: 600 !important;">
          {{'main-nav.t-and-c' | translate}}
        </span>
      </a>

      <div class="w-100 zx-border-gray-top-v-v-light my-1" [class.zx-low-opp]="isDarkMode"></div>

      <!-- Privacy Policy -->
      <a mat-list-item (click)="goToPP()">
        <span class="mat-list-item-small" style="color: var(--zx-green) !important; font-size: 13px !important; font-weight: 600 !important;">
          {{'main-nav.p-p' | translate}}
        </span>
      </a>

      <div class="w-100 zx-border-gray-top-v-v-light my-1" [class.zx-low-opp]="isDarkMode"></div>

      <span style="height: 10px;"></span>
      <span *ngIf="isIphone()" style="height: 80px;"></span>

    </mat-nav-list>
  </mat-sidenav>
  <mat-sidenav-content [class.zx-no-scroller]="isHomePage()" style="overflow-x: hidden; padding-top: 45px;">
    <router-outlet></router-outlet>
  </mat-sidenav-content>
</mat-sidenav-container>