<div class="h-100 w-100 d-flex flex-column flex-grow-1 overflow-auto">

    <div class="position-absolute w-100 d-flex" [class.justify-content-end]="isRTL">
        <button type="button" mat-icon-button aria-label="Close dialog" (click)="closeProductEditInfoDialog()"
            class="close-icon d-flex align-items-center justify-content-center" [class.text-white]="isDarkMode">
            <mat-icon>close</mat-icon>
        </button>
    </div>

    <!-- תוכן הדיאלוג -->
    <div class="dialog-content">
        <!-- כותרת -->
        <div class="dialog-header">
            <!-- כותרת שם הדגם -->
            <h5 class="section-title" [class.text-white]="isDarkMode">
                {{ 'product-edit-info.model-name' | translate }}
            </h5>
            
            <!-- שם המוצר עם כפתור עריכה -->
            <div class="product-name-container">
                <!-- מצב תצוגה -->
                <div *ngIf="!isEditingName" class="name-display-container">
                    <h4 class="dialog-title" [class.text-white]="isDarkMode">
                        {{ getCurrentDisplayName() }}
                    </h4>
                    <button class="edit-name-btn" 
                            (click)="startEditingName()"
                            [matTooltip]="'product-edit-info.edit-name-tooltip' | translate"
                            matTooltipPosition="below">
                        <mat-icon>edit</mat-icon>
                    </button>
                </div>
                
                <!-- מצב עריכה -->
                <div *ngIf="isEditingName" class="name-edit-container">
                    <mat-form-field class="name-input-field" appearance="outline">
                        <input matInput 
                               [(ngModel)]="editedProductName" 
                               [placeholder]="'product-edit-info.product-name-placeholder' | translate"
                               (keyup.enter)="saveProductName()"
                               (keyup.escape)="cancelEditingName()"
                               #nameInput>
                    </mat-form-field>
                    <div class="edit-actions">
                        <button class="save-btn" 
                                (click)="saveProductName()" 
                                [disabled]="!editedProductName.trim()">
                            <mat-icon>check</mat-icon>
                        </button>
                        <button class="cancel-btn" (click)="cancelEditingName()">
                            <mat-icon>close</mat-icon>
                        </button>
                    </div>
                </div>
                
                <!-- השם המקורי - מוצג רק אם שונה -->
                <p class="original-name-text modified" 
                   [class.text-white]="isDarkMode"
                   *ngIf="isNameModified()">
                    {{ 'product-edit-info.original-name' | translate }}: {{ originalProductName }}
                </p>
                
                <!-- כפתור "רהיט חדש" - מוצג רק אם השם שונה -->
                <div class="new-furniture-toggle" 
                     *ngIf="isNameModified()"
                     [class.dark-mode]="isDarkMode">
                    <mat-slide-toggle 
                        [(ngModel)]="isNewFurniture"
                        (change)="toggleNewFurniture()"
                        color="primary"
                        [matTooltip]="'product-edit-info.new-furniture-tooltip' | translate"
                        matTooltipPosition="below">
                        {{ 'product-edit-info.new-furniture-label' | translate }}
                    </mat-slide-toggle>
                </div>
            </div>
            
            <!-- קו הפרדה -->
            <div class="section-divider" [class.dark-mode]="isDarkMode"></div>
            
            <p class="dialog-model" [class.text-white]="isDarkMode" *ngIf="product?.model">
                {{ 'product-edit-info.model-label' | translate }}: {{ product.model }}
            </p>
            <p class="dialog-subtitle" [class.text-white]="isDarkMode">
                {{ getVisibleParams().length }} {{ 'product-edit-info.active-parameters' | translate }}
            </p>
        </div>

        <!-- תצוגת הפרמטרים -->
        <div class="parameters-grid" *ngIf="!isLoading">
            <div class="parameter-card" 
                 *ngFor="let param of getVisibleParams()" 
                 [class.dark-mode]="isDarkMode">
                
                <!-- כותרת הפרמטר -->
                <div class="param-header">
                    <h5 class="param-name">{{ param.translatedName || param.name }}</h5>
                    <span class="param-type">{{ getParameterTypeText(param) }}</span>
                </div>

                <!-- תוכן הפרמטר -->
                <div class="param-content">
                    
                    <!-- פרמטר מספרי רגיל -->
                    <div *ngIf="!isArrayParameter(param) && !hasBeamSelection(param)" class="param-info">
                        <div class="info-row">
                            <span class="info-label">{{ 'product-edit-info.current-value' | translate }}:</span>
                            <span class="info-value">{{ formatParameterValue(param) }}</span>
                        </div>
                        <div class="info-row" *ngIf="param.min !== undefined && param.max !== undefined">
                            <span class="info-label range-label">{{ 'product-edit-info.range' | translate }}:</span>
                            <span class="info-value range-value">{{ param.min }} - {{ param.max }} {{ param.unit || '' }}</span>
                        </div>
                    </div>

                    <!-- פרמטר עם בחירת קורה -->
                    <div *ngIf="hasBeamSelection(param)" class="param-info">
                        <div class="info-row">
                            <span class="info-label">{{ 'product-edit-info.beam-type' | translate }}:</span>
                            <span class="info-value">{{ getSelectedBeamName(param) }}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">{{ 'product-edit-info.wood-type' | translate }}:</span>
                            <span class="info-value">{{ getSelectedWoodType(param) }}</span>
                        </div>
                        <div class="info-row" *ngIf="!isArrayParameter(param) && needsValueDisplay(param)">
                            <span class="info-label">{{ 'product-edit-info.current-value' | translate }}:</span>
                            <span class="info-value">{{ formatParameterValue(param) }}</span>
                        </div>
                    </div>

                    <!-- פרמטר מערך (כמו מדפים) -->
                    <div *ngIf="isArrayParameter(param)" class="param-info">
                        <div class="array-values" *ngIf="param.default && param.default.length > 0">
                            <div class="array-label">{{ 'product-edit-info.values' | translate }}:</div>
                            <div class="array-items">
                                <span class="array-item" *ngFor="let value of param.default; let i = index">
                                    {{ i + 1 }}. {{ value }}{{ param.unit ? ' ' + param.unit : '' }}
                                </span>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- הודעה על פרמטרים מוסתרים -->
        <div class="hidden-params-info" *ngIf="getHiddenParamsCount() > 0" [class.dark-mode]="isDarkMode">
            <small>{{ getHiddenParamsCount() }} פרמטרים נוספים מוסתרים (isVisual)</small>
        </div>

        <!-- מצב טעינה -->
        <div *ngIf="isLoading" class="loading-container">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">{{ 'product-edit-info.loading' | translate }}</span>
            </div>
        </div>
    </div>

</div>
