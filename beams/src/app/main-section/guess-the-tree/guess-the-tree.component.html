<div class="guess-tree-container" [class.celebration]="allRevealed">
  
  <!-- אנימציית כותרת עם בלונים וקונפטי -->
  <div class="title-animation" *ngIf="showTitleAnimation">
    <h1 class="main-title">🎉 יומולדת שמח אמא! 🎉</h1>
    <div class="confetti">
      <span *ngFor="let conf of [].constructor(50)">🎊</span>
    </div>
  </div>

  <!-- כותרת משנה -->
  <h2 class="subtitle" *ngIf="!showTitleAnimation">משחק ניחושים ליומולדת - גלי מה המתנה שלך</h2>

  <!-- הודעת תוצאה -->
  <div class="guess-result" 
       *ngIf="showGuessResult" 
       [class.success]="guessResultType === 'success'"
       [class.failure]="guessResultType === 'failure'">
    <h1 class="result-message">{{ guessResultMessage }}</h1>
  </div>

  <!-- שלושת העצים -->
  <div class="trees-container" *ngIf="!showTitleAnimation">
    
    <!-- עץ 1: קרמבולה -->
    <div class="tree-card" [class.revealed]="trees[0].revealed">
      <div class="tree-image">
        <div class="tree-cover" *ngIf="!trees[0].revealed">
          🌳
        </div>
        <div class="tree-reveal" *ngIf="trees[0].revealed">
          <div class="fruit">⭐ קרמבולה ⭐</div>
        </div>
      </div>
      
      <div class="input-container">
        <div class="input-row" *ngFor="let row of trees[0].inputs; let i = index">
          <input 
            *ngFor="let char of row; let j = index"
            type="text" 
            [id]="'input-0-' + i + '-' + j"
            maxlength="1"
            class="char-input"
            [class.revealed]="isCharRevealed(trees[0], i, j)"
            [class.current]="getCurrentTree().id === trees[0].id"
            [value]="char"
            [readonly]="isCharRevealed(trees[0], i, j)"
            (keydown)="onKeyDown($event, 0, i, j)"
            (input)="setInputValue(0, i, j, $any($event.target).value)"
          />
        </div>
      </div>
    </div>

    <!-- עץ 2: מנגו מאיה -->
    <div class="tree-card" [class.revealed]="trees[1].revealed">
      <div class="tree-image">
        <div class="tree-cover" *ngIf="!trees[1].revealed">
          🌳
        </div>
        <div class="tree-reveal" *ngIf="trees[1].revealed">
          <div class="fruit">⭐ מנגו מאיה ⭐</div>
        </div>
      </div>
      
      <div class="input-container">
        <div class="input-row" *ngFor="let row of trees[1].inputs; let i = index">
          <input 
            *ngFor="let char of row; let j = index"
            type="text" 
            [id]="'input-1-' + i + '-' + j"
            maxlength="1"
            class="char-input"
            [class.revealed]="isCharRevealed(trees[1], i, j)"
            [class.current]="getCurrentTree().id === trees[1].id"
            [class.pending]="currentTreeIndex < 1"
            [value]="char"
            [readonly]="isCharRevealed(trees[1], i, j)"
            (keydown)="onKeyDown($event, 1, i, j)"
            (input)="setInputValue(1, i, j, $any($event.target).value)"
          />
        </div>
      </div>
    </div>

    <!-- עץ 3: לימון סיני -->
    <div class="tree-card" [class.revealed]="trees[2].revealed">
      <div class="tree-image">
        <div class="tree-cover" *ngIf="!trees[2].revealed">
          🌳
        </div>
        <div class="tree-reveal" *ngIf="trees[2].revealed">
          <div class="fruit">⭐ לימון סיני ⭐</div>
        </div>
      </div>
      
      <div class="input-container">
        <div class="input-row" *ngFor="let row of trees[2].inputs; let i = index">
          <input 
            *ngFor="let char of row; let j = index"
            type="text" 
            [id]="'input-2-' + i + '-' + j"
            maxlength="1"
            class="char-input"
            [class.revealed]="isCharRevealed(trees[2], i, j)"
            [class.current]="getCurrentTree().id === trees[2].id"
            [class.pending]="currentTreeIndex < 2"
            [value]="char"
            [readonly]="isCharRevealed(trees[2], i, j)"
            (keydown)="onKeyDown($event, 2, i, j)"
            (input)="setInputValue(2, i, j, $any($event.target).value)"
          />
        </div>
      </div>
    </div>
  </div>

  <!-- אפקט קונפטי -->
  <div class="confetti-overlay" *ngIf="showConfetti">
    <div class="confetti-item" *ngFor="let i of [].constructor(100)">
      {{ getRandomConfetti() }}
    </div>
  </div>

</div>
