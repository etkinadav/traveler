<div class="full-screen overflow-hidden position-relative">
    <!-- סרט תמונות רציף - מאחורי הכל כולל navBar -->
    <div class="image-film-container">
        <img *ngFor="let imagePath of getAllImagePaths(); let i = index" 
             [src]="imagePath" 
             [alt]="'Background image ' + (i + 1)"
             class="image-film-item"
             [style.animation-delay]="i * 10 + 's'">
        
        <!-- שכבה לבנה עם אנימציה של שקיפות מעל התמונות -->
        <div class="image-overlay-white"></div>
    </div>
    
    <div class="d-flex flex-grow-1 position-relative" style="z-index: 10;">

        <!-- CHOOSE PRINTING SYSTEM SIDE -->
        <div class="zx-settings-nav flex-shrink h-100 d-flex flex-column overflow-hidden position-relative"
            [class.zx-settings-nav-dark]="isDarkMode"
            style="background-color: transparent; backdrop-filter: none;">

            <article #scrollContainer
                class="w-100 h-100 d-flex p-0 p-md-3 flex-column overflow-y-auto">

                <section class="d-flex flex-column w-100 vh-100-sm-none flex-shrink-0">

                    <article id="buttonElement"
                        class="zx-about-con-down w-100 d-flex flex-column gap-2 position-sticky top-0 flex-grow-1"
                        [class.zx-dark-gb]="isDarkMode">
                        <article
                            class="w-100 d-flex flex-column gap-2 flex-grow-1 justify-content-end justify-content-md-start flex-grow-1">

                            <!-- printingService BTNs and scroll container -->
                            <article
                                class="printing-service-btn-con-con d-flex flex-column gap-3 justify-content-between flex-grow-1"
                                style="max-width: 100%;">
                                <!-- printingService BTNs -->
                                <article class="printing-service-btn-con d-flex flex-column gap-3">
                                     <!-- Products BTNs -->
                                     <div class="products-grid">
                                        <!-- כותרות "מה בונים היום" - כמות לפי האלמנטים בשורה -->
                                        <div *ngFor="let titleCard of getTitleCards(); let i = index" 
                                             class="product-card-wrapper">
                                             <div class="step-item-trans-product step-item d-flex p-1 align-items-center justify-content-center position-relative"
                                                  [class.step-item-dark]="isDarkMode"
                                                  [class.title-card-first]="i === 0"
                                                  [class.title-card-empty]="i > 0">
                                                 <div class="text-con-product d-flex flex-column flex-grow-1 justify-content-center align-items-center">
                                                <h6 class="fw-bold zx-text-big text-center" 
                                                        style="color: var(--zx-green) !important;">
                                                        <ng-container *ngIf="i === 0">{{'choose-system.step-1' | translate}}</ng-container>
                                                        <!-- ערכי כרטיסיות - comment out: ({{elementsPerRow}}) -->
                                                        <ng-container *ngIf="i > 0">-</ng-container>
                                                    </h6>
                                                 </div>
                                             </div>
                                         </div>
                                         
                                        <!-- מצב טעינה - כרטיסי דמה בכמות של פעמיים ה"כמות אלמנטים בשורה" -->
                                        <ng-container *ngIf="isLoading">
                                            <div *ngFor="let item of getLoadingItems(); let i = index" 
                                                class="product-card-wrapper">
                                                <div class="step-item-trans-product step-item shadow-85 white-background-card d-flex p-1 align-items-center justify-content-center position-relative"
                                                     [class.step-item-dark]="isDarkMode">
                                                    <!-- כפתור המשך למוצר -->
                                                    <button mat-stroked-button 
                                                            class="continue-to-product-btn opacity-75 loading-button-shine" 
                                                            disabled>
                                                        <span class="opacity-75 zx-text-tiny zx-text-sm-small text-center loading-dots-shine">&nbsp;</span>
                                                    </button>
                                                     
                                                     <div class="d-flex align-items-center gap-3">
                                                         <div class="product-icon zx-big-icon-size-trans d-flex align-items-center justify-content-center rounded loading-shimmer">
                                                         </div>
                                                     </div>
                                                     
                                                    <div class="text-con-product d-flex flex-column flex-grow-1 justify-content-between">
                                                        <h6 class="fw-bold zx-text-big text-center text-muted opacity-75">
                                                            &nbsp;
                                                        </h6>
                                                        <span class="opacity-75 zx-text-tiny zx-text-sm-small text-center text-green">
                                                            &nbsp;
                                                        </span>
                                                    </div>
                                                </div>
                                             </div>
                                         </ng-container>
                                         
                                        <!-- מצב רגיל - מוצרים אמיתיים מקובצים לפי סוג -->
                                        <ng-container *ngIf="!isLoading">
                                            <!-- לולאה על כל קבוצת מוצרים -->
                                            <ng-container *ngFor="let group of groupedProducts; let groupIndex = index">
                                                <!-- מוצרים בקבוצה -->
                                                <div *ngFor="let product of group.items; let i = index" 
                                                    #productCard
                                                    (mouseenter)="!product.isEmpty && onHoverProduct(product)" 
                                                    (mouseleave)="!product.isEmpty && onHoverProduct(null)" 
                                                    class="product-card-wrapper"
                                                    [class.mega-card-border-top]="shouldShowTopBorder(groupIndex, i)"
                                                    [class.mega-card-border-right]="shouldShowRightBorder(groupIndex, i)"
                                                    [class.mega-card-border-bottom]="shouldShowBottomBorder(groupIndex, i)"
                                                    [class.mega-card-border-left]="shouldShowLeftBorder(groupIndex, i)"
                                                    [attr.data-product-index]="getGlobalProductIndex(groupIndex, i)">
                                                    
                                                <!-- כרטיסיה ריקה -->
                                                <ng-container *ngIf="product.isEmpty">
                                                    <div class="step-item-trans-product step-item position-relative empty-card"
                                                         [class.step-item-dark]="isDarkMode">
                                                        <!-- ערכי כרטיסיות - comment out
                                                        <div class="mega-card-number">
                                                            x: {{groupIndex + 1}}, y: {{i + 1}}, r: {{(getGlobalProductIndex(groupIndex, i) % elementsPerRow) + 1}}, s: {{getGlobalProductIndex(groupIndex, i) + 1}}
                                                        </div>
                                                        -->
                                                        <!-- תוכן ריק -->
                                                        <div class="white-background-card shadow-85 p-1 flex-grow-1">
                                                        </div>
                                                    </div>
                                                </ng-container>
                                                
                                                <!-- כרטיסיה רגילה -->
                                                <ng-container *ngIf="!product.isEmpty">
                                                <div [class.zx-step-choosen]="selectedProduct?._id === product._id" 
                                                     class="step-item-trans-product step-item position-relative"
                                                     [class.step-item-dark]="isDarkMode">
                                                    
                                                    <!-- כותרת קטגוריה - רק בכרטיסייה הראשונה -->
                                                    <div *ngIf="i === 0" class="category-title-container">
                                                        <div class="d-flex flex-column align-items-center">
                                                            <h6 class="fw-bold zx-text-big text-center" 
                                                                style="color: var(--zx-green) !important; margin: 0;">
                                                                {{ group.productTypeName }}
                                                            </h6>
                                                            <span class="opacity-75 text-center text-green" style="margin-top: 4px; font-size: 18px;">
                                                                דגם - {{product.model || product.name || 'מוצר מותאם אישית'}}
                                                            </span>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- ערכי כרטיסיות - comment out
                                                    <div class="mega-card-number">
                                                        x: {{groupIndex + 1}}, y: {{i + 1}}, r: {{(getGlobalProductIndex(groupIndex, i) % elementsPerRow) + 1}}, s: {{getGlobalProductIndex(groupIndex, i) + 1}}
                                                    </div>
                                                    -->
                                                    
                                                    <!-- תוכן הכרטיסייה עם רקע לבן -->
                                                    <div class="white-background-card shadow-85 p-1 flex-grow-1">
                                                    <div class="d-flex flex-column align-items-center gap-3 h-100">
                                                        
                                                        <!-- שם המוצר - למעלה -->
                                                        <div class="text-con-product d-flex flex-column justify-content-center">
                                                            <h6 class="fw-bold zx-text-big text-center">
                                                                {{product.translatedName}}
                                                            </h6>
                                                        </div>
                                                        
                                                        <!-- תלת מימד - למטה -->
                                                        <div class="product-icon zx-big-icon-size-trans d-flex align-items-center justify-content-center rounded position-relative">
                                                            <!-- רנדור 3D רק למוצרים שנראים במסך -->
                                                            <ng-container *ngIf="isProductVisible(getGlobalProductIndex(groupIndex, i))">
                                                                <app-product-mini-preview 
                                                                    #miniPreview 
                                                                    [product]="product" 
                                                                    [configurationIndex]="product.configurationIndex || 0" 
                                                                    style="width: 100%; height: 100%;" 
                                                                    (ngOnInit)="logProductCreation(product)">
                                                                </app-product-mini-preview>
                                                                
                                                            <!-- כיסוי שקוף מעל המודל התלת-ממדי -->
                                                            <div class="product-3d-overlay" 
                                                                 (click)="removeOverlay($event, miniPreview)"
                                                                 (mouseenter)="showHintForProduct(product._id + '_' + i)"
                                                                 (mouseleave)="hideHintForProduct(product._id + '_' + i)">
                                                                <!-- טקסט הוראה בריחוף -->
                                                                <div *ngIf="showHintMap[product._id + '_' + i]" 
                                                                     class="overlay-hint show"
                                                                     [@fadeInOut]>
                                                                    לחץ לשינוי המבט
                                                                </div>
                                                                </div>
                                                            </ng-container>
                                                            
                                                            <!-- placeholder עבור מוצרים שלא נראים במסך - זהה לכרטיסיות דמה -->
                                                            <div 
                                                                *ngIf="!isProductVisible(getGlobalProductIndex(groupIndex, i))"
                                                                class="loading-shimmer">
                                                            </div>
                                                            
                                                            <!-- כפתור בחירה מרחף מעל התלת מימד -->
                                                            <button mat-stroked-button 
                                                                    class="floating-select-btn" 
                                                                    (click)="navigateToProduct(product); $event.stopPropagation()">
                                                                <div class="btn-content">
                                                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                        <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                                        <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                                        <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                                    </svg>
                                                                    <span>התאם מידות</span>
                                                                </div>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                    <!-- סגירת white-background-card -->
                                             </div>
                                             <!-- סגירת step-item-trans-product -->
                                             </ng-container>
                                             <!-- סגירת כרטיסיה רגילה -->
                                            </div>
                                            <!-- סגירת product-card-wrapper -->
                                            </ng-container>
                                            <!-- סגירת קבוצה -->
                                         </ng-container>
                                         <!-- סגירת מצב רגיל -->
                                    </div>
                                
                                </article>
                            </article>
                        </article>

                    </article>

                    <div class="mat-toolbar-height d-lg-none"></div>
                </section>

                <article></article>

            </article>
            <!-- action BTN -->
            <div class="w-100 p-2 shadow-85-strong zx-z-index-1 hide-main-btn"
                *ngIf="printingService === 'express' || printingService === 'plotter' || printingService === 'ph'"
                [class.show-main-btn]="isSystemSet">
                <button type="button" mat-raised-button color="primary"
                    class="text-white rounded-2 w-100 zx-medium-btn zx-main-btn-effects fw-bold"
                    (click)="onSetPrintingService()">
                    {{ continueToServiceText }}
                </button>
            </div>
            <!-- // action BTN -->

        </div>

        <!-- // CHOOSE PRINTING SYSTEM SIDE -->
         


    </div>
</div>