<div class="threejs-box-wrapper">
    <!-- הודעת validation הוסרה - משתמשים ב-SnackBar -->
    
    <!-- קונטיינר לכפתורי תצוגה -->
    <div class="view-controls-container">
        <!-- כפתור להצגת wireframe - מוסתר במובייל ובמוצר קורות -->
        <button class="wireframe-toggle hide-on-mobile" (click)="toggleWireframe()" 
                [class.active]="showWireframe" 
                matTooltip="{{ 'modify-product.show-dimensions-tooltip' | translate }}"
                matTooltipPosition="below"
                *ngIf="!isBelams">
            <!-- SVG Icon -->
            <svg width="12" height="12" viewBox="0 0 12 12" style="margin-left:8px;">
                <rect x="1" y="1" width="10" height="10" stroke="currentColor" stroke-width="0.8" fill="none"/>
                <line x1="1" y1="6" x2="11" y2="6" stroke="currentColor" stroke-width="0.8"/>
                <line x1="6" y1="1" x2="6" y2="11" stroke="currentColor" stroke-width="0.8"/>
            </svg>
            <span class="button-text">{{ showWireframe ? ('hide_dimensions' | translate) : ('show_dimensions' | translate) }}</span>
        </button>
        
        <!-- כפתור תפריט אפשרויות נוספות -->
        <button class="options-menu-button" 
                [class.active]="isOptionsMenuOpen"
                (click)="toggleOptionsMenu()"
                matTooltip="{{ 'modify-product.additional-options-tooltip' | translate }}"
                matTooltipPosition="below">
            <svg width="12" height="12" viewBox="0 0 12 12">
                <circle cx="6" cy="2" r="1.2" fill="currentColor"/>
                <circle cx="6" cy="6" r="1.2" fill="currentColor"/>
                <circle cx="6" cy="10" r="1.2" fill="currentColor"/>
            </svg>
        </button>
        
        <!-- כפתור ניהול מערכת -->
        <button class="system-management-button" 
                [class.active]="isSystemMenuOpen"
                (click)="toggleSystemMenu()"
                matTooltip="{{ 'modify-product.system-management-tooltip' | translate }}"
                matTooltipPosition="below">
            <svg width="12" height="12" viewBox="0 0 12 12">
                <!-- אייקון ניהול מערכת - גלגל שיניים עדין -->
                <circle cx="6" cy="6" r="4" stroke="currentColor" stroke-width="0.8" fill="none"/>
                <circle cx="6" cy="6" r="1.5" fill="currentColor"/>
                <path d="M6 2L6 1M10 6L11 6M6 10L6 11M2 6L1 6" stroke="currentColor" stroke-width="0.6" stroke-linecap="round"/>
                <path d="M8.5 3.5L9.5 2.5M8.5 8.5L9.5 9.5M3.5 8.5L2.5 9.5M3.5 3.5L2.5 2.5" stroke="currentColor" stroke-width="0.6" stroke-linecap="round"/>
            </svg>
        </button>
    </div>
    
    <!-- תפריט אפשרויות נוספות -->
    <div class="custom-menu" [class.open]="isOptionsMenuOpen" *ngIf="isOptionsMenuOpen">
        <!-- אפשרות החלף מוצר -->
        <button class="menu-option" (click)="navigateToHome(); isOptionsMenuOpen = false">
            <svg width="14" height="14" viewBox="0 0 16 16">
                <!-- עיפרון פשוט -->
                <path d="M12.146 1.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1 0 .708l-9 9a.5.5 0 0 1-.168.11l-4 1.5a.5.5 0 0 1-.65-.65l1.5-4a.5.5 0 0 1 .11-.168l9-9z" 
                      stroke="currentColor" stroke-width="0.8" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M11 2l3 3" stroke="currentColor" stroke-width="0.8" stroke-linecap="round"/>
            </svg>
            <span>{{ 'change_product' | translate }}</span>
        </button>
        
        <!-- אפשרות הצגת wireframe - מוסתרת במובייל ובמוצר קורות -->
        <button class="menu-option show-on-mobile" 
                (click)="toggleWireframe(); isOptionsMenuOpen = false" 
                [class.active]="showWireframe" 
                *ngIf="!isBelams">
            <svg width="18" height="18" viewBox="0 0 12 12">
                <rect x="1" y="1" width="10" height="10" stroke="currentColor" stroke-width="0.8" fill="none"/>
                <line x1="1" y1="6" x2="11" y2="6" stroke="currentColor" stroke-width="0.8"/>
                <line x1="6" y1="1" x2="6" y2="11" stroke="currentColor" stroke-width="0.8"/>
            </svg>
            <span>{{ showWireframe ? ('hide_dimensions' | translate) : ('show_dimensions' | translate) }}</span>
        </button>
        
        <!-- אפשרות מצב שקוף - מוסתרת במוצר קורות -->
        <button class="menu-option" 
                (click)="toggleTransparentMode(); isOptionsMenuOpen = false" 
                [class.active]="isTransparentMode" 
                *ngIf="!isBelams">
            <svg width="18" height="18" viewBox="0 0 12 12">
                <rect x="2" y="2" width="8" height="8" stroke="currentColor" stroke-width="0.8" fill="none"/>
                <path d="M2 2L10 10M10 2L2 10" stroke="currentColor" stroke-width="0.8"/>
            </svg>
            <span>{{ isTransparentMode ? ('hide_transparent' | translate) : ('show_transparent' | translate) }}</span>
        </button>
        
        <!-- אפשרות קוביית ניווט במובייל -->
        <button class="menu-option" 
                (click)="toggleNavigationCube(); isOptionsMenuOpen = false" 
                [class.active]="showNavigationCube">
            <svg width="18" height="18" viewBox="0 0 12 12">
                <!-- קוביה תלת-מימדית עם קווים מחברים -->
                <rect x="2" y="2" width="8" height="8" stroke="currentColor" stroke-width="0.8" fill="none"/>
                <rect x="3.5" y="3.5" width="5" height="5" stroke="currentColor" stroke-width="0.6" fill="none"/>
                <line x1="2" y1="2" x2="3.5" y2="3.5" stroke="currentColor" stroke-width="0.6"/>
                <line x1="10" y1="2" x2="8.5" y2="3.5" stroke="currentColor" stroke-width="0.6"/>
                <line x1="2" y1="10" x2="3.5" y2="8.5" stroke="currentColor" stroke-width="0.6"/>
                <line x1="10" y1="10" x2="8.5" y2="8.5" stroke="currentColor" stroke-width="0.6"/>
            </svg>
            <span>{{ showNavigationCube ? ('hide_navigation_cube' | translate) : ('show_navigation_cube' | translate) }}</span>
        </button>
        
        <!-- אפשרות איפוס מבט המצלמה -->
        <button class="menu-option" (click)="resetCameraView(); isOptionsMenuOpen = false">
            <svg width="18" height="18" viewBox="0 0 12 12">
                <!-- עין פשוטה -->
                <ellipse cx="6" cy="6" rx="4" ry="2.5" stroke="currentColor" stroke-width="0.8" fill="none"/>
                <circle cx="6" cy="6" r="1.5" fill="currentColor"/>
                <circle cx="6.5" cy="5.5" r="0.5" fill="white"/>
            </svg>
            <span>{{ 'reset_camera' | translate }}</span>
        </button>
        
        <!-- אפשרות הצגת חצים - מוסתרת במוצר קורות -->
        <button class="menu-option" 
                (click)="toggleCoordinateAxes(); isOptionsMenuOpen = false" 
                [class.active]="showCoordinateAxes" 
                *ngIf="!isBelams">
            <svg width="18" height="18" viewBox="0 0 12 12">
                <!-- חצים תלת-מימדיים -->
                <line x1="6" y1="2" x2="6" y2="10" stroke="currentColor" stroke-width="0.8"/>
                <line x1="2" y1="6" x2="10" y2="6" stroke="currentColor" stroke-width="0.8"/>
                <line x1="4" y1="4" x2="8" y2="8" stroke="currentColor" stroke-width="0.8"/>
                <!-- חצים -->
                <polygon points="6,2 5,4 7,4" fill="currentColor"/>
                <polygon points="10,6 8,5 8,7" fill="currentColor"/>
                <polygon points="8,8 6,7 7,9" fill="currentColor"/>
            </svg>
            <span>{{ showCoordinateAxes ? ('hide_axes' | translate) : ('show_axes' | translate) }}</span>
        </button>
        
        <!-- אפשרות הוראות הרכבה -->
        <button class="menu-option assembly-instructions-menu-option" 
                (click)="toggleAssemblyInstructions(); isOptionsMenuOpen = false"
                [class.active]="isInstructionMode">
            <svg width="14" height="14" viewBox="0 0 16 16" style="display: block; overflow: visible;">
                <!-- אייקון מסמך/הוראות -->
                <rect x="2" y="2" width="12" height="12" rx="1" stroke="currentColor" stroke-width="0.8" fill="none"/>
                <line x1="5" y1="6" x2="11" y2="6" stroke="currentColor" stroke-width="0.8"/>
                <line x1="5" y1="9" x2="11" y2="9" stroke="currentColor" stroke-width="0.8"/>
                <line x1="5" y1="12" x2="9" y2="12" stroke="currentColor" stroke-width="0.8"/>
            </svg>
            <span>{{ isInstructionMode ? ('modify-product.view-edit-menu' | translate) : ('modify-product.view-assembly-instructions' | translate) }}</span>
        </button>
    </div>
    
    <!-- תפריט ניהול מערכת -->
    <div class="custom-menu" [class.open]="isSystemMenuOpen" *ngIf="isSystemMenuOpen">
            <!-- אפשרות עריכת מוצר -->
            <button class="menu-option" (click)="editProduct(); isSystemMenuOpen = false">
                <svg width="18" height="18" viewBox="0 0 16 16">
                    <!-- עיפרון פשוט -->
                    <path d="M12.146 1.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1 0 .708l-9 9a.5.5 0 0 1-.168.11l-4 1.5a.5.5 0 0 1-.65-.65l1.5-4a.5.5 0 0 1 .11-.168l9-9z" 
                          stroke="currentColor" stroke-width="0.8" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M11 2l3 3" stroke="currentColor" stroke-width="0.8" stroke-linecap="round"/>
                </svg>
                <span>{{ 'edit_product' | translate }}</span>
            </button>
    </div>
    
    <!-- קוביית ניווט במובייל -->
    <div class="mobile-navigation-cube" *ngIf="showNavigationCube" [@fadeInScale]>
        <div class="nav-cube-title">{{ 'modify-product.choose-view' | translate }}</div>
        
        <!-- קוביה עם כפתורים -->
        <div class="mobile-base-cube">
            <!-- כפתור למעלה -->
            <button class="mobile-nav-button mobile-top-button" (click)="onNavigationClick('top')">
                <span class="nav-text">{{ 'modify-product.view-up' | translate }}</span>
            </button>
            
            <!-- כפתור שמאל -->
            <button class="mobile-nav-button mobile-left-button" (click)="onNavigationClick('left')">
                <span class="nav-text">{{ 'modify-product.view-left' | translate }}</span>
            </button>
            
            <!-- כפתור קדמי (מרכז) -->
            <button class="mobile-nav-button mobile-front-button" (click)="onNavigationClick('front')">
                <span class="nav-text">{{ 'modify-product.view-front' | translate }}</span>
            </button>
            
            <!-- כפתור ימין -->
            <button class="mobile-nav-button mobile-right-button" (click)="onNavigationClick('right')">
                <span class="nav-text">{{ 'modify-product.view-right' | translate }}</span>
            </button>
            
            <!-- כפתור תחתון -->
            <button class="mobile-nav-button mobile-back-button" (click)="onNavigationClick('bottom')">
                <span class="nav-text">{{ 'modify-product.view-down' | translate }}</span>
            </button>
        </div>
        
        <button class="nav-cube-close" (click)="toggleNavigationCube()">✕</button>
    </div>
    
    <!-- התרעה על קורות מוסתרות -->
    <div class="hidden-beams-warning" *ngIf="hasHiddenBeams && !hasNoMiddleBeams && showHiddenBeamsWarning">
        <svg width="12" height="12" viewBox="0 0 12 12" style="margin-left:8px;">
            <circle cx="6" cy="6" r="5" stroke="currentColor" stroke-width="0.8" fill="none"/>
            <path d="M6 3v3M6 8h.01" stroke="currentColor" stroke-width="0.8" fill="none"/>
        </svg>
        <span class="button-text">{{ 'hidden_beams_warning' | translate: {count: hiddenBeamsCount, beamType: getBeamTypeText()} }}</span>
        <div class="close-button-spacer"></div>
        <button class="close-warning-btn" (click)="dismissHiddenBeamsWarning()" [attr.aria-label]="'close-branch.btn' | translate">
            <svg width="10" height="10" viewBox="0 0 10 10">
                <line x1="2" y1="2" x2="8" y2="8" stroke="currentColor" stroke-width="1.2"/>
                <line x1="8" y1="2" x2="2" y2="8" stroke="currentColor" stroke-width="1.2"/>
            </svg>
        </button>
    </div>
    
    <!-- התרעה על מקרה קיצון - אין קורות באמצע -->
    <div class="hidden-beams-warning critical" *ngIf="hasNoMiddleBeams && showNoMiddleBeamsWarning">
        <svg width="12" height="12" viewBox="0 0 12 12" style="margin-left:8px;">
            <circle cx="6" cy="6" r="5" stroke="currentColor" stroke-width="0.8" fill="none"/>
            <path d="M6 3v3M6 8h.01" stroke="currentColor" stroke-width="0.8" fill="none"/>
        </svg>
        <span class="button-text">{{ 'no_middle_beams_warning' | translate }}</span>
        <div class="close-button-spacer"></div>
        <button class="close-warning-btn" (click)="dismissNoMiddleBeamsWarning()" [attr.aria-label]="'close-branch.btn' | translate">
            <svg width="10" height="10" viewBox="0 0 10 10">
                <line x1="2" y1="2" x2="8" y2="8" stroke="currentColor" stroke-width="1.2"/>
                <line x1="8" y1="2" x2="2" y2="8" stroke="currentColor" stroke-width="1.2"/>
            </svg>
        </button>
    </div>
    
    <div class="main-flex-row">
        <div class="controls" [class.closed]="!drawerOpen">
            <button class="drawer-toggle" (click)="toggleDrawer()">
                <svg width="12" height="12" viewBox="0 0 12 12" style="display:block;margin:auto;">
                    <polyline points="4,2 8,6 4,10" stroke="#666" stroke-width="2" fill="none"
                        [attr.transform]="drawerOpen ? 'rotate(180 6 6)' : ''" />
                </svg>
            </button>
            <ng-container *ngIf="drawerOpen">
                <!-- כותרת מוצר - תמיד גלויה -->
                <div class="product-header" *ngIf="selectedProductName" style="margin-bottom: 20px;">
                    <h3 style="margin: 0; padding: 10px; text-align: center;">
                        {{getDisplayProductName}}<br>
                            <span style="margin-top: 8px; font-weight: normal; font-size: 0.8em; display: block; color: #0066cc;">{{ 'modify-product.model-label' | translate }} {{product?.model || product?.name || selectedProductName}}</span>
                    </h3>
                </div>
                
                <!-- כל התוכן הרגיל - מוסתר במצב הוראות הרכבה -->
                <div class="inputs-container-animated" [@slideUpDown]="isInstructionMode ? 'collapsed' : 'expanded'">
                <!-- Spinner Loading - מוצג רק בטעינה הראשונית -->
                <div class="loading-spinner" *ngIf="isLoading && isModelLoading">
                    <div class="simple-spinner tiny"></div>
                </div>
                
                <div *ngFor="let param of params" class="param-box">
                    
                    <!-- טיפול בשולחן - פרמטר height -->
                    <div *ngIf="isTable && param.name === 'height'">
                        <label style="font-weight:bold; display:block; margin-bottom: 1.5em;">{{param.translatedName}}</label>
                        <mat-form-field appearance="outline" class="with-quick-commit">
                            <mat-label>{{param.translatedName}} ({{param.min}} < {{param.max}})</mat-label>
                            <input #heightInput matInput type="number"
                                   [ngModel]="param.editingValue ?? param.default"
                                   (ngModelChange)="param.editingValue = $event"
                                   (focus)="onNumberFocus(param)"
                                   (blur)="onNumberCommit(param)"
                                   (keyup.enter)="onNumberCommit(param)"
                                   (input)="onNumberInput(param, $event)">
                            <button type="button" class="quick-commit-btn" *ngIf="shouldShowCommit(param)" (click)="onNumberQuickCommit(param, heightInput)">
                                <svg width="12" height="12" viewBox="0 0 12 12">
                                    <path d="M2 6l2 2 6-6" stroke="#0066cc" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </mat-form-field>
                    </div>
                    
                    <!-- טיפול בארון - פרמטר shelfs -->
                    <div *ngIf="!isTable && param.name === 'shelfs'">
                        <label
                            style="font-weight:bold; display:block; margin-bottom: 1.5em;">{{param.translatedName}}</label>
                        <div class="shelf-row">
                            <div class="custom-select-wrapper">
                                <label class="custom-select-label">{{ 'modify-product.beam-type-label' | translate }}</label>
                                <div class="custom-dropdown" (click)="toggleDropdown('beam', param)" [class.open]="isDropdownOpen('beam', param)">
                                    <div class="dropdown-selected">
                                        {{param.beams[param.selectedBeamIndex]?.translatedName}}
                                        <svg class="dropdown-arrow" [class.rotated]="isDropdownOpen('beam', param)" width="16" height="16" viewBox="0 0 24 24">
                                            <polyline points="6,9 12,15 18,9" stroke="currentColor" stroke-width="2" fill="none"/>
                                        </svg>
                                    </div>
                                    <div class="dropdown-options" *ngIf="isDropdownOpen('beam', param)" (click)="$event.stopPropagation()">
                                        <div *ngFor="let beam of param.beams; let bIdx = index" 
                                             class="dropdown-option" 
                                             [class.selected]="bIdx === param.selectedBeamIndex"
                                             (click)="selectBeam(bIdx, param)">
                                            {{beam.translatedName}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="custom-select-wrapper">
                                <label class="custom-select-label">{{ 'modify-product.wood-type-label' | translate }}</label>
                                <div class="custom-dropdown" (click)="toggleDropdown('type', param)" [class.open]="isDropdownOpen('type', param)">
                                    <div class="dropdown-selected">
                                        {{param.beams[param.selectedBeamIndex]?.types[param.selectedTypeIndex]?.translatedName}}
                                        <svg class="dropdown-arrow" [class.rotated]="isDropdownOpen('type', param)" width="16" height="16" viewBox="0 0 24 24">
                                            <polyline points="6,9 12,15 18,9" stroke="currentColor" stroke-width="2" fill="none"/>
                                        </svg>
                                    </div>
                                    <div class="dropdown-options" *ngIf="isDropdownOpen('type', param)" (click)="$event.stopPropagation()">
                                        <div *ngFor="let type of param.beams[param.selectedBeamIndex]?.types; let tIdx = index" 
                                             class="dropdown-option" 
                                             [class.selected]="tIdx === param.selectedTypeIndex"
                                             (click)="selectType(tIdx, param)">
                                            {{type.translatedName}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="add-shelf-btn-container">
                            <button class="add-shelf-btn" (click)="param.default.push(param.min); updateBeams()">
                                <svg viewBox="0 0 16 16" width="14" height="14">
                                    <circle cx="8" cy="8" r="7" fill="#fff" />
                                    <line x1="8" y1="4" x2="8" y2="12" stroke="#333" stroke-width="2" />
                                    <line x1="4" y1="8" x2="12" y2="8" stroke="#333" stroke-width="2" />
                                </svg>
                            </button>
                        </div>
                        <div class="shelf-measurements-container beam-array-container">
                            <div *ngFor="let i of [].constructor(param.default?.length || 0); let idx = index" 
                                class="shelf-row" 
                                [class.shelf-row-with-amount]="param.setAmount === true">
                                <div class="shelf-gap-field-wrapper">
                                    <mat-form-field appearance="outline" class="shelf-gap-field">
                                        <mat-label>{{ 'modify-product.measurement-label' | translate }} {{(param.default?.length || 0) - idx}} ({{param.min}} < {{param.max}} {{getUnitForParameter(param)}})</mat-label>
                                        <input #shelfInput matInput type="number" [step]="1"
                                            [ngModel]="param._editingValues?.[(param.default?.length || 0) - 1 - idx] ?? param.default?.[(param.default?.length || 0) - 1 - idx]"
                                            (ngModelChange)="(param._editingValues = param._editingValues || []); param._editingValues[(param.default?.length || 0) - 1 - idx] = $event"
                                            (focus)="onShelfNumberFocus(param, (param.default?.length || 0) - 1 - idx)"
                                            (blur)="onShelfNumberCommit(param, (param.default?.length || 0) - 1 - idx)"
                                            (keyup.enter)="onShelfNumberCommit(param, (param.default?.length || 0) - 1 - idx)"
                                            (input)="onShelfNumberInput(param, $event, (param.default?.length || 0) - 1 - idx)">
                                        <button type="button" class="quick-commit-btn" *ngIf="shouldShowShelfCommit(param, (param.default?.length || 0) - 1 - idx)" (click)="onShelfQuickCommit(param, (param.default?.length || 0) - 1 - idx, shelfInput)">
                                            <svg width="12" height="12" viewBox="0 0 12 12">
                                                <path d="M2 6l2 2 6-6" stroke="#0066cc" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </button>
                                    </mat-form-field>
                                    <button *ngIf="idx !== (param.default?.length || 0) - 1" class="remove-shelf-btn" 
                                        [class.remove-shelf-btn-with-amount]="param.setAmount === true"
                                        (click)="param.default.splice((param.default?.length || 0) - 1 - idx,1); updateBeams()"
                                        [disabled]="(param.default?.length || 0)<=1" [attr.aria-label]="'modify-product.remove-shelf-aria' | translate">
                                        <svg width="14" height="14" viewBox="0 0 14 14">
                                            <circle cx="7" cy="7" r="6" fill="#fff" stroke="#d32f2f" stroke-width="1.2" />
                                            <line x1="4.5" y1="4.5" x2="9.5" y2="9.5" stroke="#d32f2f" stroke-width="1.5" />
                                            <line x1="9.5" y1="4.5" x2="4.5" y2="9.5" stroke="#d32f2f" stroke-width="1.5" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
            
                        </div>
                    </div>
                    
                    <!-- טיפול במוצר קורות לפי מידה - פרמטר beams עם setAmount (בדיוק כמו קורות מדף של השולחן) -->
                    <div *ngIf="isBelams && param.name === 'beams' && param.setAmount">
                        <label style="font-weight:bold; display:block; margin-bottom: 1.5em;">{{param.translatedName}}</label>
                        <div class="shelf-row">
                            <div class="custom-select-wrapper">
                                <label class="custom-select-label">{{ 'modify-product.beam-type-label' | translate }}</label>
                                <div class="custom-dropdown" (click)="toggleDropdown('beam', param)" [class.open]="isDropdownOpen('beam', param)">
                                    <div class="dropdown-selected">
                                        {{param.beams[param.selectedBeamIndex]?.translatedName}}
                                        <svg class="dropdown-arrow" [class.rotated]="isDropdownOpen('beam', param)" width="16" height="16" viewBox="0 0 24 24">
                                            <polyline points="6,9 12,15 18,9" stroke="currentColor" stroke-width="2" fill="none"/>
                                        </svg>
                                    </div>
                                    <div class="dropdown-options" *ngIf="isDropdownOpen('beam', param)" (click)="$event.stopPropagation()">
                                        <div *ngFor="let beam of param.beams; let bIdx = index" 
                                             class="dropdown-option" 
                                             [class.selected]="bIdx === param.selectedBeamIndex"
                                             (click)="selectBeam(bIdx, param)">
                                            {{beam.translatedName}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="custom-select-wrapper">
                                <label class="custom-select-label">{{ 'modify-product.wood-type-label' | translate }}</label>
                                <div class="custom-dropdown" (click)="toggleDropdown('type', param)" [class.open]="isDropdownOpen('type', param)">
                                    <div class="dropdown-selected">
                                        {{param.beams[param.selectedBeamIndex || 0]?.types[param.selectedTypeIndex]?.translatedName}}
                                        <svg class="dropdown-arrow" [class.rotated]="isDropdownOpen('type', param)" width="16" height="16" viewBox="0 0 24 24">
                                            <polyline points="6,9 12,15 18,9" stroke="currentColor" stroke-width="2" fill="none"/>
                                        </svg>
                                    </div>
                                    <div class="dropdown-options" *ngIf="isDropdownOpen('type', param)" (click)="$event.stopPropagation()">
                                        <div *ngFor="let type of param.beams[param.selectedBeamIndex || 0]?.types || []; let tIdx = index" 
                                             class="dropdown-option" 
                                             [class.selected]="tIdx === param.selectedTypeIndex"
                                             (click)="selectType(tIdx, param)">
                                            {{type.translatedName}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="add-shelf-btn-container">
                            <button class="add-shelf-btn" (click)="addBeamWithAmount(param); updateBeams()">
                                <svg viewBox="0 0 16 16" width="14" height="14">
                                    <circle cx="8" cy="8" r="7" fill="#fff" />
                                    <line x1="8" y1="4" x2="8" y2="12" stroke="#333" stroke-width="2" />
                                    <line x1="4" y1="8" x2="12" y2="8" stroke="#333" stroke-width="2" />
                                </svg>
                            </button>
                        </div>
                        <div class="shelf-measurements-container beam-array-container">
                            <div *ngFor="let i of [].constructor(param.default?.length || 0); let idx = index" 
                                class="shelf-row" 
                                [class.shelf-row-with-amount]="param.setAmount === true">
                                <div class="shelf-gap-field-wrapper">
                                    <div class="beam-entry-container">
                                        <mat-form-field appearance="outline" class="shelf-gap-field-length">
                                            <mat-label>{{ 'modify-product.length-label' | translate }} {{(param.default?.length || 0) - idx}} ({{param.min}} < {{param.max}} {{getUnitForParameter(param)}})</mat-label>
                                            <input matInput type="number" [step]="1"
                                                [ngModel]="param.default && param.default[(param.default?.length || 0) - 1 - idx] ? param.default[(param.default?.length || 0) - 1 - idx].length : null"
                                                (ngModelChange)="param.default && param.default[(param.default?.length || 0) - 1 - idx] ? param.default[(param.default?.length || 0) - 1 - idx].length = $event : null"
                                                (blur)="updateShelfParameterValue(param, param.default?.[(param.default?.length || 0) - 1 - idx], (param.default?.length || 0) - 1 - idx)"
                                                (keyup.enter)="updateShelfParameterValue(param, param.default?.[(param.default?.length || 0) - 1 - idx], (param.default?.length || 0) - 1 - idx)"
                                                (input)="onShelfInputChange($event, param, idx)">
                                        </mat-form-field>
                                        <div class="quantity-container">
                                            <div class="quantity-label-above">{{ 'modify-product.quantity-label' | translate }}</div>
                                            <div class="quantity-control">
                                                <!-- במובייל: פלוס למעלה -->
                                                <button class="quantity-btn plus"
                                                        (click)="increaseAmount(param, idx)">
                                                    <svg width="12" height="12" viewBox="0 0 12 12">
                                                        <line x1="6" y1="4" x2="6" y2="8" stroke="currentColor" stroke-width="1.5"/>
                                                        <line x1="4" y1="6" x2="8" y2="6" stroke="currentColor" stroke-width="1.5"/>
                                                    </svg>
                                                </button>
                                                 <!-- באמצע: ערך הזנה -->
                                                 <input class="quantity-input"
                                                        type="number" 
                                                        [ngModel]="param.default && param.default[(param.default?.length || 0) - 1 - idx] ? param.default[(param.default?.length || 0) - 1 - idx].amount : null"
                                                        (ngModelChange)="param.default && param.default[(param.default?.length || 0) - 1 - idx] ? param.default[(param.default?.length || 0) - 1 - idx].amount = $event : null"
                                                        (change)="updateShelfParameterValue(param, param.default?.[(param.default?.length || 0) - 1 - idx], (param.default?.length || 0) - 1 - idx)"
                                                        (keyup.enter)="updateShelfParameterValue(param, param.default?.[(param.default?.length || 0) - 1 - idx], (param.default?.length || 0) - 1 - idx)"
                                                        (input)="onShelfInputChange($event, param, idx)"
                                                        min="1">
                                                <!-- למטה: מינוס -->
                                                <button class="quantity-btn minus" 
                                                        (click)="decreaseAmount(param, idx)">
                                                    <svg width="12" height="12" viewBox="0 0 12 12">
                                                        <line x1="4" y1="6" x2="8" y2="6" stroke="currentColor" stroke-width="1.5"/>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <button *ngIf="idx !== (param.default?.length || 0) - 1" class="remove-shelf-btn"
                                        [class.remove-shelf-btn-with-amount]="param.setAmount === true"
                                        (click)="param.default.splice((param.default?.length || 0) - 1 - idx,1); updateBeams()"
                                        [disabled]="(param.default?.length || 0)<=1" [attr.aria-label]="'modify-product.remove-beam-aria' | translate">
                                        <svg width="14" height="14" viewBox="0 0 14 14">
                                            <circle cx="7" cy="7" r="6" fill="#fff" stroke="#d32f2f" stroke-width="1.2" />
                                            <line x1="4.5" y1="4.5" x2="9.5" y2="9.5" stroke="#d32f2f" stroke-width="1.5" />
                                            <line x1="9.5" y1="4.5" x2="4.5" y2="9.5" stroke="#d32f2f" stroke-width="1.5" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    
                    <!-- טיפול בשולחן - פרמטר plata -->
                    <div *ngIf="isTable && param.name === 'plata'">
                        <label style="font-weight:bold; display:block; margin-bottom: 1.5em;">{{param.translatedName}}</label>
                        <div class="shelf-row">
                            <div class="custom-select-wrapper">
                                <label class="custom-select-label">{{ 'modify-product.beam-type-label' | translate }}</label>
                                <div class="custom-dropdown" (click)="toggleDropdown('beam', param)" [class.open]="isDropdownOpen('beam', param)">
                                    <div class="dropdown-selected">
                                        {{param.beams[param.selectedBeamIndex]?.translatedName}}
                                        <svg class="dropdown-arrow" [class.rotated]="isDropdownOpen('beam', param)" width="16" height="16" viewBox="0 0 24 24">
                                            <polyline points="6,9 12,15 18,9" stroke="currentColor" stroke-width="2" fill="none"/>
                                        </svg>
                                    </div>
                                    <div class="dropdown-options" *ngIf="isDropdownOpen('beam', param)" (click)="$event.stopPropagation()">
                                        <div *ngFor="let beam of param.beams; let bIdx = index" 
                                             class="dropdown-option" 
                                             [class.selected]="bIdx === param.selectedBeamIndex"
                                             (click)="selectBeam(bIdx, param)">
                                            {{beam.translatedName}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="custom-select-wrapper">
                                <label class="custom-select-label">{{ 'modify-product.wood-type-label' | translate }}</label>
                                <div class="custom-dropdown" (click)="toggleDropdown('type', param)" [class.open]="isDropdownOpen('type', param)">
                                    <div class="dropdown-selected">
                                        {{param.beams[param.selectedBeamIndex || 0]?.types[param.selectedTypeIndex]?.translatedName}}
                                        <svg class="dropdown-arrow" [class.rotated]="isDropdownOpen('type', param)" width="16" height="16" viewBox="0 0 24 24">
                                            <polyline points="6,9 12,15 18,9" stroke="currentColor" stroke-width="2" fill="none"/>
                                        </svg>
                                    </div>
                                    <div class="dropdown-options" *ngIf="isDropdownOpen('type', param)" (click)="$event.stopPropagation()">
                                        <div *ngFor="let type of param.beams[param.selectedBeamIndex || 0]?.types || []; let tIdx = index" 
                                             class="dropdown-option" 
                                             [class.selected]="tIdx === param.selectedTypeIndex"
                                             (click)="selectType(tIdx, param)">
                                            {{type.translatedName}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div *ngIf="param.type === 'beamSingle' && (!isTable || param.name !== 'plata' || isPlanter || isBox)">
                        <label
                            style="font-weight:bold; display:block; margin-bottom: 1.5em;">{{param.translatedName}}</label>
                        <div class="custom-select-wrapper">
                            <label class="custom-select-label">סוג קורה</label>
                            <div class="custom-dropdown" (click)="toggleDropdown('beam', param)" [class.open]="isDropdownOpen('beam', param)">
                                <div class="dropdown-selected">
                                    {{param.beams[param.selectedBeamIndex]?.translatedName}}
                                    <svg class="dropdown-arrow" [class.rotated]="isDropdownOpen('beam', param)" width="16" height="16" viewBox="0 0 24 24">
                                        <polyline points="6,9 12,15 18,9" stroke="currentColor" stroke-width="2" fill="none"/>
                                    </svg>
                                </div>
                                <div class="dropdown-options" *ngIf="isDropdownOpen('beam', param)" (click)="$event.stopPropagation()">
                                    <div *ngFor="let beam of param.beams; let bIdx = index" 
                                         class="dropdown-option" 
                                         [class.selected]="bIdx === param.selectedBeamIndex"
                                         (click)="selectBeam(bIdx, param)">
                                        {{beam.translatedName}}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="custom-select-wrapper">
                            <label class="custom-select-label">סוג עץ</label>
                            <div class="custom-dropdown" (click)="toggleDropdown('type', param)" [class.open]="isDropdownOpen('type', param)">
                                <div class="dropdown-selected">
                                    {{param.beams[param.selectedBeamIndex]?.types[param.selectedTypeIndex]?.translatedName}}
                                    <svg class="dropdown-arrow" [class.rotated]="isDropdownOpen('type', param)" width="16" height="16" viewBox="0 0 24 24">
                                        <polyline points="6,9 12,15 18,9" stroke="currentColor" stroke-width="2" fill="none"/>
                                    </svg>
                                </div>
                                <div class="dropdown-options" *ngIf="isDropdownOpen('type', param)" (click)="$event.stopPropagation()">
                                    <div *ngFor="let type of param.beams[param.selectedBeamIndex]?.types; let tIdx = index" 
                                         class="dropdown-option" 
                                         [class.selected]="tIdx === param.selectedTypeIndex"
                                         (click)="selectType(tIdx, param)">
                                        {{type.translatedName}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- פרמטר extraBeam מיוחד עבור שולחן -->
                    <div *ngIf="isTable && param.name === 'extraBeam'">
                        <label style="font-weight:bold; display:block; margin-bottom: 1.5em;">{{param.translatedName}}</label>
                        <div class="param-box non-beam">
                            <mat-form-field appearance="outline" class="with-quick-commit">
                                <mat-label>{{param.translatedName}} ({{param.min}} < {{param.max}} {{getUnitForParameter(param)}})</mat-label>
                                <input #extraInput matInput type="number"
                                    [step]="getStep(param.type)"
                                    [ngModel]="param.editingValue ?? param.default"
                                    (ngModelChange)="param.editingValue = $event"
                                    (focus)="onNumberFocus(param)"
                                    (blur)="onGenericNumberCommit(param)"
                                    (keyup.enter)="onGenericNumberCommit(param)"
                                    (input)="onNumberInput(param, $event)">
                                <button type="button" class="quick-commit-btn" *ngIf="shouldShowCommit(param)" (click)="onNumberQuickCommit(param, extraInput)">
                                    <svg width="12" height="12" viewBox="0 0 12 12">
                                        <path d="M2 6l2 2 6-6" stroke="#0066cc" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                            </mat-form-field>
                        </div>
                    </div>
                    
                    <!-- פרמטר boolean (toggle) -->
                    <div *ngIf="param.type === 'boolian' && (param.name !== 'openCover' || getParam('isCover')?.default === true)" class="boolean-param">
                        <span class="boolean-label">{{param.translatedName}}</span>
                        <mat-slide-toggle 
                            [(ngModel)]="param.default"
                            (change)="onBooleanParamChange(param.name)"
                            color="primary">
                        </mat-slide-toggle>
                    </div>
                    
                    
                    <div *ngIf="param.type !== 'beamSingle' && param.type !== 'boolian' && param.name !== 'shelfs' && !(isTable && param.name === 'height') && !(isTable && param.name === 'extraBeam')">
                        <label
                            style="font-weight:bold; display:block; margin-bottom: 1.5em;">{{param.translatedName}}</label>
                        <div class="param-box non-beam">
                            <mat-form-field appearance="outline" class="with-quick-commit">
                                <mat-label>{{param.translatedName}} ({{param.min}} < {{param.max}} {{getUnitForParameter(param)}})</mat-label>
                                <input #genericInput matInput type="number"
                                    [step]="getStep(param.type)"
                                    [ngModel]="param.editingValue ?? param.default"
                                    (ngModelChange)="param.editingValue = $event"
                                    (focus)="onNumberFocus(param)"
                                    (blur)="onGenericNumberCommit(param)"
                                    (keyup.enter)="onGenericNumberCommit(param)"
                                    (input)="onNumberInput(param, $event)">
                                <button type="button" class="quick-commit-btn" *ngIf="shouldShowCommit(param)" (click)="onNumberQuickCommit(param, genericInput)">
                                    <svg width="12" height="12" viewBox="0 0 12 12">
                                        <path d="M2 6l2 2 6-6" stroke="#0066cc" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                            </mat-form-field>
                        </div>
                    </div>
                </div>
                
                <!-- שדה כמות יחידות -->
                <div class="quantity-selector" *ngIf="!isLoading || !isModelLoading">
                    <label class="quantity-label">{{ 'modify-product.quantity-units' | translate }}</label>
                    <div class="quantity-control">
                        <button class="quantity-btn minus" (click)="decreaseQuantity()" [disabled]="quantity <= 1">
                            <svg width="12" height="12" viewBox="0 0 12 12">
                                <line x1="3" y1="6" x2="9" y2="6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </button>
                        <input 
                            type="number" 
                            class="quantity-input" 
                            [(ngModel)]="quantity" 
                            (change)="onQuantityChange($event)"
                            min="1">
                        <button class="quantity-btn plus" (click)="increaseQuantity()">
                            <svg width="12" height="12" viewBox="0 0 12 12">
                                <line x1="6" y1="3" x2="6" y2="9" stroke="currentColor" stroke-width="2"/>
                                <line x1="3" y1="6" x2="9" y2="6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- טבלת מידות המוצר - מוסתר למוצר beams -->
                <div class="product-dimensions-container" *ngIf="!isLoading && !isBelams">
                    <h3>{{ 'modify-product.product-dimensions-title' | translate }}</h3>
                    <table class="dimensions-table">
                        <!-- מידות כוללות - לכל המוצרים -->
                        <tr>
                            <td>{{ 'modify-product.total-length' | translate }}</td>
                            <td [innerHTML]="getProductDimensions().length"></td>
                        </tr>
                        <tr>
                            <td>{{ 'modify-product.total-width' | translate }}</td>
                            <td [innerHTML]="getProductDimensions().width"></td>
                        </tr>
                        <tr>
                            <td>{{ 'modify-product.total-height' | translate }}</td>
                            <td [innerHTML]="getProductDimensions().height"></td>
                        </tr>
                        
                        <!-- מידות ספציפיות - רק לארון, שולחן ומיטה -->
                        <tr *ngIf="!isPlanter && !isBox">
                            <td>{{ (isTable || isFuton) ? ('modify-product.platform-beam-count' | translate) : ('modify-product.shelf-beam-count' | translate) }}</td>
                            <td [innerHTML]="getProductDimensions().beamCount"></td>
                        </tr>
                        <tr *ngIf="!isPlanter && !isBox">
                            <td>{{ (isTable || isFuton) ? ('modify-product.platform-beam-gap' | translate) : ('modify-product.shelf-beam-gap' | translate) }}</td>
                            <td [innerHTML]="getProductDimensions().gapBetweenBeams"></td>
                        </tr>
                        
                        <!-- כמות מדפים - רק לארון -->
                        <tr *ngIf="!isTable && !isFuton && !isPlanter && !isBox">
                            <td>{{ 'modify-product.shelf-count' | translate }}</td>
                            <td [innerHTML]="getProductDimensions().shelfCount"></td>
                        </tr>
                    </table>
                </div>
                
                </div> <!-- סיום התוכן הרגיל -->
                
                <!-- כפתור הוראות הרכבה - תמיד גלוי -->
                <div class="assembly-instructions-container" [class.no-margin-top]="isInstructionMode">
                    <button class="assembly-instructions-button-inline" 
                            (click)="toggleAssemblyInstructions()"
                            [class.active]="isInstructionMode">
                        <svg *ngIf="isInstructionMode" class="back-arrow-icon" width="16" height="16" viewBox="0 0 16 16">
                            <path d="M 10 2 L 4 8 L 10 14" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>{{ isInstructionMode ? ('modify-product.view-edit-menu' | translate) : ('modify-product.view-assembly-instructions' | translate) }}</span>
                    </button>
                    
                    <!-- הוראות הרכבה - מוצג רק במצב isInstructionMode -->
                    <div class="assembly-instructions-content" *ngIf="isInstructionMode && product?.instructions && product.instructions.length > 0">
                        <h3 class="instructions-title">{{ 'modify-product.assembly-instructions-title' | translate }}</h3>
                        <div class="instructions-accordion">
                            <div *ngFor="let instruction of product.instructions; let i = index" class="instruction-accordion-item">
                                <!-- כותרת ההוראה - לחיצה לפתיחה/סגירה -->
                                <div class="instruction-accordion-header" 
                                     (click)="toggleInstructionStage(i)"
                                     [class.active]="isInstructionStageOpen(i)">
                                    <span class="instruction-accordion-number">{{ i + 1 }}</span>
                                    <span class="instruction-accordion-title">{{ instruction.translatedName }}</span>
                                    <svg class="instruction-accordion-arrow" 
                                         [class.open]="isInstructionStageOpen(i)"
                                         width="16" height="16" viewBox="0 0 16 16">
                                        <path d="M 4 6 L 8 10 L 12 6" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </div>
                                
                                <!-- תוכן ההוראה - נפתח/נסגר -->
                                <div class="instruction-accordion-content" 
                                     [@slideUpDown]="isInstructionStageOpen(i) ? 'expanded' : 'collapsed'">
                                    <!-- תוכן רגיל של ההוראה -->
                                    <div class="instruction-content-text">
                                        <!-- כאן יכול להיות תוכן נוסף של ההוראה בעתיד -->
                                    </div>
                                    
                                    <!-- קדיחת קדחים מקדימים - מוצג רק אם זו ההוראה הראשונה והיא preliminary-drills -->
                                    <div class="preliminary-drills-content" 
                                         *ngIf="i === 0 && instruction.name === 'preliminary-drills' && preliminaryDrillsInfo.length > 0">
                                        
                                        <div class="preliminary-drills-list">
                                            <div *ngFor="let drillInfo of preliminaryDrillsInfo; trackBy: trackByParamName" class="preliminary-drill-item">
                                                <!-- הודעת מצב אחת -->
                                                <div class="preliminary-drill-check-item"
                                                     [attr.data-checkbox-element]="drillInfo.paramName">
                                                    <!-- צ'קבוקס - תמיד מוצג -->
                                                    <div class="preliminary-drill-checkbox"
                                                         [class.checked]="!drillInfo.requiresPreliminaryScrews || isBeamMarkedAsCompleted(drillInfo.paramName)"
                                                         [class.already-checked]="!drillInfo.requiresPreliminaryScrews"
                                                         (click)="toggleBeamCompleted(drillInfo)">
                                                        <svg *ngIf="!drillInfo.requiresPreliminaryScrews || isBeamMarkedAsCompleted(drillInfo.paramName)" 
                                                             class="checkbox-check-icon" 
                                                             width="12" height="12" viewBox="0 0 12 12">
                                                            <path d="M 2 6 L 5 9 L 10 3" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                                                        </svg>
                                                    </div>
                                                    <span class="check-text">
                                                        <span *ngIf="drillInfo.requiresPreliminaryScrews">
                                                            {{ 'modify-product.preliminary-drills-required' | translate: {beamName: drillInfo.beamTypeName} }}
                                                        </span>
                                                        <span *ngIf="!drillInfo.requiresPreliminaryScrews">
                                                            {{ 'modify-product.preliminary-drills-not-required' | translate: {beamName: drillInfo.beamTypeName} }}
                                                        </span>
                                                    </span>
                                                </div>
                                                
                                                <!-- טקסט הוראות קידוח - מוצג רק כשצריך קידוח וזה השלב הנוכחי ויש כפתור -->
                                                <div class="preliminary-drills-instruction-text-wrapper" 
                                                     *ngIf="drillInfo.requiresPreliminaryScrews && !isBeamMarkedAsCompleted(drillInfo.paramName) && isFirstUncheckedBeam(drillInfo.paramName)">
                                                    <div *ngFor="let instructionText of getPreliminaryDrillsInstructionText(drillInfo); let i = index" class="instruction-text-with-drawing">
                                                        <p class="preliminary-drills-instruction-text" 
                                                           [innerHTML]="instructionText">
                                                        </p>
                                                        
                                                        <!-- מלבן שרטוט - מתחת לכל טקסט הוראה -->
                                                        <div class="drilling-drawing-wrapper">
                                                            <app-drawing
                                                                [isDrillingMode]="true"
                                                                [beamType]="drillInfo.beamTypeName || drillInfo.beamDisplayName || ''"
                                                                [product]="getCurrentProductConfiguration()"
                                                                [beamLength]="getBeamDimensionsForInstruction(drillInfo, i).length"
                                                                [beamWidth]="getBeamDimensionsForInstruction(drillInfo, i).width">
                                                            </app-drawing>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- כפתור "הקידוחים בוצעו" - מתחת לצ'קבוקס הראשון שלא סומן -->
                                                <div class="preliminary-drills-completed-button-wrapper" 
                                                     *ngIf="drillInfo.requiresPreliminaryScrews && !isBeamMarkedAsCompleted(drillInfo.paramName) && isFirstUncheckedBeam(drillInfo.paramName)">
                                                    <button class="preliminary-drills-completed-button" 
                                                            (click)="markBeamAsCompleted(drillInfo)">
                                                        <span>{{ 'modify-product.drilling-completed' | translate }}</span>
                                                        <svg class="action-arrow-icon" width="14" height="14" viewBox="0 0 14 14">
                                                            <path d="M 2 7 L 10 7 M 7 3 L 11 7 L 7 11" stroke="white" stroke-width="1.8" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                                                        </svg>
                                                    </button>
                                                </div>
                                                
                                            </div>
                                        </div>
                                        
                                        <!-- הודעה וכפתור אם כל הקורות הן V -->
                                        <div class="preliminary-drills-success-message" *ngIf="areAllBeamsNoPreliminaryDrilling()">
                                            <div class="preliminary-drills-success-text">
                                                {{ 'modify-product.no-preliminary-drilling-needed' | translate }}
                                            </div>
                                            <div class="preliminary-drills-button-wrapper"
                                                 [attr.data-button-element]="'continue-button'">
                                                <button class="preliminary-drills-continue-button" (click)="goToNextInstructionStage()">
                                                    <span>{{ 'modify-product.understood-continue-next' | translate }}</span>
                                                    <svg class="action-arrow-icon" width="14" height="14" viewBox="0 0 14 14">
                                                        <path d="M 5 2 L 9 7 L 5 12" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                                                    </svg>
                                                </button>
                                            </div>
                                            
                                        </div>
                                        
                                        <!-- כפתור המשך אם יש קורות שדורשות קדחים וכולן סומנו - מוסר כי המעבר אוטומטי -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>
        </div>
        <div #rendererContainer class="renderer-container" [class.expanded]="!drawerOpen">
            <!-- Spinner במרכז התצוגה התלת-מימדית -->
            <div class="model-loading-spinner" *ngIf="isModelLoading">
                <div class="simple-spinner tiny"></div>
            </div>
            
        </div>
    </div>
    
    
    <!-- אזור חישוב המחיר -->
    <div class="price-calculation-area" [class.minimized]="isPriceMinimized">
        <!-- כפתור צמצום/הרחב -->
        <button class="minimize-btn" mat-icon-button 
                [matTooltip]="isPriceMinimized ? ('modify-product.show-additional-options' | translate) : ('modify-product.minimize' | translate)"
                matTooltipPosition="above"
                (click)="togglePriceMinimize()"
                [class.expanded-mode]="isPriceMinimized"
                [attr.aria-label]="'modify-product.minimize-expand-aria' | translate"
                *ngIf="calculatedPrice > 0">
            <mat-icon>{{ isPriceMinimized ? 'unfold_more' : 'close' }}</mat-icon>
        </button>
        
        <button class="fullscreen-btn" mat-icon-button color="primary" 
                [matTooltip]="!isPriceManuOpen ? ('price-calculation.tooltip' | translate) : ('modify-product.minimize-menu-tooltip' | translate)" 
                matTooltipPosition="above"
                (click)="togglePriceMenu()"
                *ngIf="!isPriceMinimized && calculatedPrice > 0"
                [attr.aria-label]="'modify-product.fullscreen-aria' | translate">
            <mat-icon>{{ isPriceManuOpen ? 'fullscreen_exit' : 'fullscreen' }}</mat-icon>
        </button>
        <div class="price-info">
            <div class="price-display-wrapper">
                <!-- כפתור בחירת אופציה -->
                <button class="pricing-option-button" 
                        [matMenuTriggerFor]="pricingOptionsMenu"
                        *ngIf="calculatedPrice > 0 && !isPriceMinimized">
                    <div class="option-name-small">
                        {{ getPricingOptionName() }}
                        <svg class="edit-icon" width="12" height="12" viewBox="0 0 12 12">
                            <path d="M 8.5 1 L 11 3.5 L 4 10.5 L 1 11 L 1.5 8 Z" 
                                  stroke="#0066cc" 
                                  stroke-width="1" 
                                  fill="none" 
                                  stroke-linejoin="round"/>
                            <line x1="7.5" y1="2" x2="10" y2="4.5" stroke="#0066cc" stroke-width="0.8"/>
                        </svg>
                    </div>
                    
                    <!-- קפסולות פירוט מחיר -->
                    <div class="price-capsules">
                        <!-- שרטוט - תמיד מוצג -->
                        <div class="price-capsule">
                            <div class="capsule-label">{{ 'modify-product.drawing' | translate }}</div>
                            <div class="capsule-value">{{ drawingPrice }} <span class="currency-symbol">₪</span></div>
                        </div>
                        <!-- קורות - רק אם נבחרו -->
                        <div class="price-capsule" *ngIf="isBeamsEnabled">
                            <div class="capsule-label">{{ isCuttingEnabled ? ('pricing_option_cut_short' | translate) : ('pricing_option_full_short' | translate) }}</div>
                            <div class="capsule-value">{{ getBeamsOnlyPrice() + (isCuttingEnabled ? getCuttingPrice() : 0) }} <span class="currency-symbol">₪</span></div>
                        </div>
                        <!-- ברגים - רק אם נבחרו -->
                        <div class="price-capsule" *ngIf="isScrewsEnabled">
                            <div class="capsule-label">{{ 'modify-product.screws' | translate }}</div>
                            <div class="capsule-value">{{ getScrewsPrice() }} <span class="currency-symbol">₪</span></div>
                        </div>
                    </div>
                    
                    <div class="price-display">
                        <!-- קונטיינר פנימי למחיר בלבד -->
                        <div class="price-only-wrapper">
                            <span class="price-label">{{ 'modify-product.total-label' | translate }}</span>
                            <div class="price-value-inline">
                                {{ getFinalPrice() }} ₪
                            </div>
                        </div>
                        
                        <!-- כפתור המשך -->
                        <button class="continue-button" 
                                *ngIf="calculatedPrice > 0"
                                [@fadeInScale]
                                (click)="handleAddToCart(); $event.stopPropagation()">
                            <span class="continue-text">
                                <span *ngIf="isEditMode">{{ 'modify-product.save-changes' | translate }}</span>
                                <span *ngIf="!isEditMode">{{ 'modify-product.add-to-cart' | translate }}</span>
                            </span>
                            <svg class="continue-arrow" width="14" height="14" viewBox="0 0 14 14">
                                <path d="M 2 7 L 10 7 M 7 3 L 11 7 L 7 11" stroke="currentColor" stroke-width="1.8" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </button>
                
                <!-- Overlay לתפריט אזהרה -->
                <div class="warning-overlay" *ngIf="showWarningMenu" (click)="closeWarningMenu()"></div>
                
                <!-- תפריט אזהרה -->
                <div class="warning-menu" *ngIf="showWarningMenu" [@fadeInOut]>
                    <!-- כפתור X לסגירה -->
                    <button class="close-warning-btn" (click)="closeWarningMenu(); $event.stopPropagation()" 
                            [attr.aria-label]="'close-branch.btn' | translate">
                        <svg width="12" height="12" viewBox="0 0 12 12">
                            <line x1="2" y1="2" x2="10" y2="10" stroke="currentColor" stroke-width="1.5"/>
                            <line x1="10" y1="2" x2="2" y2="10" stroke="currentColor" stroke-width="1.5"/>
                        </svg>
                    </button>
                    
                    <!-- כותרת -->
                    <h3 class="warning-title">{{ 'modify-product.warning-title' | translate }}</h3>
                    
                    <!-- הודעות אזהרה -->
                    <div class="warning-messages">
                        <!-- אזהרת מידות -->
                        <p *ngIf="checkIfHasDimensionsAlert()" class="warning-message">
                            {{ 'modify-product.dimensions-alert-message' | translate: {actualHeight: getActualHeight(), heightDifference: getAbsoluteHeightDifference(), heightDifferenceText: getHeightDifferenceText()} }}
                        </p>
                        
                        <!-- אזהרת קורות חסרות -->
                        <p *ngIf="hasHiddenBeams" class="warning-message">
                            {{ 'hidden_beams_warning' | translate: {count: getHiddenBeamsCount(), beamType: getBeamTypeName()} }}
                        </p>
                        
                        <!-- אזהרת אין קורות באמצע -->
                        <p *ngIf="hasNoMiddleBeams" class="warning-message">
                            {{ 'no_middle_beams_warning' | translate }}
                        </p>
                    </div>
                    
                    <!-- כפתור אישור -->
                    <button class="confirm-button" (click)="confirmAddToCart(); $event.stopPropagation()">
                        <span *ngIf="isEditMode">{{ 'modify-product.understood-save-changes' | translate }}</span>
                        <span *ngIf="!isEditMode">{{ 'modify-product.understood-add-to-cart' | translate }}</span>
                    </button>
                </div>
                
                <!-- תצוגת טעינה -->
        <div class="price-loader" *ngIf="calculatedPrice === 0">
            <div class="simple-spinner always-tiny"></div>
            <span class="calculating-text">{{ 'modify-product.calculating-price' | translate }}</span>
        </div>
                
                <!-- תצוגה מצומצמת - שורת מחיר + כפתור המשך -->
                <div class="minimized-price-container" 
                     *ngIf="isPriceMinimized && calculatedPrice > 0"
                     [@fadeInScale]>
                    <!-- שורת המחיר - כפתור שמרחיב ופותח אופציות -->
                    <button class="minimized-price-display" (click)="expandAndOpenPricingOptions()">
                        <span class="price-option-name">{{ getPricingOptionShortName() }}</span>
                        <div class="price-value-inline">
                            {{ getFinalPrice() }} ₪
                        </div>
                    </button>
                    
                    <!-- כפתור המשך -->
                    <button class="minimized-continue-button" 
                            (click)="handleAddToCart(); $event.stopPropagation()">
                        <span class="continue-text">
                            <span *ngIf="isEditMode">{{ 'modify-product.save-changes' | translate }}</span>
                            <span *ngIf="!isEditMode">{{ 'modify-product.add-to-cart' | translate }}</span>
                        </span>
                        <svg class="continue-arrow" width="14" height="14" viewBox="0 0 14 14">
                            <path d="M 2 7 L 10 7 M 7 3 L 11 7 L 7 11" stroke="currentColor" stroke-width="1.8" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- תפריט אופציות תמחור -->
        <mat-menu #pricingOptionsMenu="matMenu" class="pricing-options-menu" [class.has-alerts]="hasAnyAlert" [hasBackdrop]="true" (click)="$event.stopPropagation()">
            <div class="pricing-menu-header" (click)="$event.stopPropagation()">
                <button class="close-menu-btn" (click)="pricingMenuTrigger.closeMenu()" style="position: absolute !important; top: 8px !important; left: 12px !important; background: none !important; border: none !important; padding: 4px !important; cursor: pointer !important; z-index: 10 !important;">
                    <svg width="12" height="12" viewBox="0 0 16 16" style="display: block !important;">
                        <path d="M 4 4 L 12 12 M 12 4 L 4 12" stroke="white" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
                <div class="header-container">
                    <div class="header-title" style="font-size: 16px !important; font-weight: bold !important; color: #0066cc !important; text-align: center !important;">{{ 'modify-product.what-would-you-like' | translate }}</div>
                </div>
            </div>
            
            <!-- קטגוריה 1: הוראות -->
            <div class="menu-category" (click)="$event.stopPropagation()">
                <div class="category-row" (click)="$event.stopPropagation()">
                    <div class="simple-checkbox always-visible mandatory" (click)="$event.stopPropagation()">
                        <div class="checkbox-border">
                            <div class="checkmark">✓</div>
                        </div>
                    </div>
                    <div class="category-title">{{ 'modify-product.instructions' | translate }}</div>
                    <div class="category-price">{{ drawingPrice }} ₪</div>
                </div>
            </div>
            
            <!-- קטגוריה 2: קורות -->
            <div class="menu-category" (click)="$event.stopPropagation()">
                <div class="category-row" (click)="$event.stopPropagation()">
                    <div class="simple-checkbox" (click)="toggleBeamsOption(); $event.stopPropagation()" [class.active]="isBeamsEnabled">
                        <div class="checkbox-border">
                            <div class="checkmark">✓</div>
                        </div>
                    </div>
                    <div class="category-title" (click)="$event.stopPropagation()">{{ 'modify-product.beams' | translate }}</div>
                    <div class="category-price-container">
                        <div class="edit-icon-div" 
                             *ngIf="isBeamsEnabled"
                             matTooltip="{{ 'modify-product.edit-tooltip' | translate }}" 
                             matTooltipPosition="above"
                             (click)="toggleBeamsEditOptions(); $event.stopPropagation()">
                            <svg width="12" height="12" viewBox="0 0 12 12" class="edit-icon">
                                <path d="M 8.5 1 L 11 3.5 L 4 10.5 L 1 11 L 1.5 8 Z" 
                                      stroke="currentColor" 
                                      stroke-width="1" 
                                      fill="none" 
                                      stroke-linejoin="round"/>
                                <line x1="7.5" y1="2" x2="10" y2="4.5" 
                                      stroke="currentColor" 
                                      stroke-width="0.8"/>
                            </svg>
                        </div>
                        <div class="category-price" (click)="$event.stopPropagation()" [class.crossed-out]="!isBeamsEnabled" style="display: flex; align-items: center; gap: 8px;">
                            <div *ngIf="getHasBeamsChanged() && getOriginalBeamsPrice() !== getBeamsOnlyPrice()" class="crossed-price">{{ getOriginalBeamsPrice() }} ₪</div>
                            <div *ngIf="getHasBeamsChanged() && getOriginalBeamsPrice() !== getBeamsOnlyPrice()" class="new-price">{{ getBeamsOnlyPrice() }} ₪</div>
                            <div *ngIf="!getHasBeamsChanged() || getOriginalBeamsPrice() === getBeamsOnlyPrice()">{{ getBeamsOnlyPrice() }} ₪</div>
                        </div>
                    </div>
                </div>
                
                <!-- אופציות עריכה לקורות -->
                <div class="edit-options" *ngIf="showBeamsEditOptions">
                    <div class="edit-options-list">
                        <!-- כותרת -->
                        <div class="edit-header-row">
                            <span class="edit-header-title">{{ 'modify-product.edit-beam-quantity' | translate }}</span>
                        </div>
                        
                        <!-- רשימת קורות -->
                        <div class="edit-option-row" *ngFor="let beam of getBeamsForEdit(); let i = index">
                            <div class="option-text-container">
                       <div class="option-line-1">{{ beam.beamTranslatedName }}</div>
                       <div class="option-line-2">{{ beam.type?.translatedName || beam.beamWoodType }} - קורת {{ getBeamLengthInMeters(beam) }} {{ 'modify-product.beam-meter' | translate }}</div>
                       <div class="option-line-3">{{ 'modify-product.price-per-unit' | translate }} {{ getBeamPrice(beam) }} ₪</div>
                            </div>
                            <div class="quantity-controls">
                                <div class="qty-btn" (click)="$event.stopPropagation(); $event.preventDefault(); updateBeamQuantity(i, getFullBeamsCount(beam) - 1)">-</div>
                                <input type="number" 
                                       class="qty-input" 
                                       [value]="getFullBeamsCount(beam)"
                                       (input)="updateBeamQuantity(i, +$any($event.target).value); $event.stopPropagation()"
                                       min="0">
                                <div class="qty-btn" (click)="$event.stopPropagation(); $event.preventDefault(); updateBeamQuantity(i, getFullBeamsCount(beam) + 1)">+</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- קטגוריה 3: חיתוך קורות -->
            <div class="menu-category" (click)="$event.stopPropagation()" [class.disabled]="!isBeamsEnabled">
                <div class="category-row" (click)="$event.stopPropagation()">
                    <div class="simple-checkbox" 
                         (click)="toggleCuttingOption(); $event.stopPropagation()" 
                         [class.active]="isCuttingEnabled"
                         [class.disabled]="!isBeamsEnabled">
                        <div class="checkbox-border">
                            <div class="checkmark">✓</div>
                        </div>
                    </div>
                    <div class="category-title" (click)="$event.stopPropagation()" [class.disabled]="!isBeamsEnabled">{{ 'modify-product.cutting' | translate }}</div>
                    <div class="category-price" (click)="$event.stopPropagation()" [class.crossed-out]="!isCuttingEnabled">
                        <span>{{ getCuttingPrice() }} ₪</span>
                    </div>
                </div>
                <!-- הודעת אזהרה נפרדת מתחת לחיתוך -->
                <div *ngIf="!isCuttingPossible && isBeamsEnabled" class="insufficient-beams-message">{{ 'modify-product.insufficient-beams-for-cutting' | translate }}</div>
            </div>
            
            <!-- קטגוריה 4: ברגים -->
            <div class="menu-category" (click)="$event.stopPropagation()">
                <div class="category-row" (click)="$event.stopPropagation()">
                    <div class="simple-checkbox" (click)="toggleScrewsOption(); $event.stopPropagation()" [class.active]="isScrewsEnabled">
                        <div class="checkbox-border">
                            <div class="checkmark">✓</div>
                        </div>
                    </div>
                    <div class="category-title" (click)="$event.stopPropagation()">{{ 'modify-product.screws' | translate }}</div>
                    <div class="category-price-container">
                        <div class="edit-icon-div" 
                             *ngIf="isScrewsEnabled"
                             matTooltip="{{ 'modify-product.edit-tooltip' | translate }}" 
                             matTooltipPosition="above"
                             (click)="toggleScrewsEditOptions(); $event.stopPropagation()">
                            <svg width="12" height="12" viewBox="0 0 12 12" class="edit-icon">
                                <path d="M 8.5 1 L 11 3.5 L 4 10.5 L 1 11 L 1.5 8 Z" 
                                      stroke="currentColor" 
                                      stroke-width="1" 
                                      fill="none" 
                                      stroke-linejoin="round"/>
                                <line x1="7.5" y1="2" x2="10" y2="4.5" 
                                      stroke="currentColor" 
                                      stroke-width="0.8"/>
                            </svg>
                        </div>
                        <div class="category-price" (click)="$event.stopPropagation()" [class.crossed-out]="!isScrewsEnabled" style="display: flex; align-items: center; gap: 8px;">
                            <div *ngIf="getHasScrewsChanged() && getOriginalScrewsPrice() !== getScrewsPrice()" class="crossed-price">{{ getOriginalScrewsPrice() }} ₪</div>
                            <div *ngIf="getHasScrewsChanged() && getOriginalScrewsPrice() !== getScrewsPrice()" class="new-price">{{ getScrewsPrice() }} ₪</div>
                            <div *ngIf="!getHasScrewsChanged() || getOriginalScrewsPrice() === getScrewsPrice()">{{ getScrewsPrice() }} ₪</div>
                        </div>
                    </div>
                </div>
                
                <!-- אופציות עריכה לברגים -->
                <div class="edit-options" *ngIf="showScrewsEditOptions">
                    <div class="edit-options-list">
                        <!-- כותרת -->
                        <div class="edit-header-row">
                            <span class="edit-header-title">{{ 'modify-product.edit-screw-quantity' | translate }}</span>
                        </div>
                        
                        <!-- רשימת ברגים -->
                        <div class="edit-option-row" *ngFor="let screw of getScrewsForEdit(); let i = index">
                            <div class="option-text-container">
                                <div class="option-line-1">{{ screw.screwTranslatedName }}</div>
                                <div class="option-line-2">{{ screw.optimalPackage.translatedName }}</div>
                                <div class="option-line-3">{{ 'modify-product.price-per-unit' | translate }} {{ screw.optimalPackage?.price || 0 }} ₪</div>
                            </div>
                            <div class="quantity-controls">
                                <div class="qty-btn" (click)="$event.stopPropagation(); $event.preventDefault(); updateScrewQuantity(i, screw.numPackages - 1)">-</div>
                                <input type="number" 
                                       class="qty-input" 
                                       [value]="screw.numPackages"
                                       (input)="updateScrewQuantity(i, +$any($event.target).value); $event.stopPropagation()"
                                       min="0">
                                <div class="qty-btn" (click)="$event.stopPropagation(); $event.preventDefault(); updateScrewQuantity(i, screw.numPackages + 1)">+</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </mat-menu>
        
        
        <!-- קופסא נוספת שמופיעה כשהתפריט פתוח -->
        <div class="price-menu-box" 
             [class.with-warning]="hasHiddenBeams || hasNoMiddleBeams"
             *ngIf="isPriceManuOpen">
            <!-- כותרת ראשית -->
            <div class="main-header-title" style="text-align: center;">{{ 'modify-product.calculations' | translate }}</div>
            
            <!-- מצב loading -->
            <div class="pricing-menu-loading" *ngIf="isModelLoading">
                <div class="simple-spinner always-tiny"></div>
                <span class="calculating-text">{{ 'modify-product.calculating-price' | translate }}</span>
            </div>
            
            <!-- תוכן התפריט - מוסתר בזמן loading -->
            <ng-container *ngIf="!isModelLoading">
            <!-- כותרת דינמית -->
            <span class="thinking-text" *ngIf="!BeamsDataForPricing || BeamsDataForPricing.length === 0">{{ 'price-calculation.first-title' | translate }}...</span>
            
            <!-- הוראות חיתוך והרכבה (תמיד מוצגות) -->
            <div class="instructions-section">
                <div class="main-title">{{ 'modify-product.cutting-assembly-instructions' | translate }}</div>
                <div class="materials-summary required-lengths-summary">
                    <div class="beam-type-section">
                        <div class="size-item">
                            <span class="size-value">{{ 'modify-product.drawing' | translate }}</span>
                            <span class="size-separator"></span>
                            <span class="size-count">{{ drawingPrice }} ₪</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- קורות - רק אם מופעלות -->
            <div class="beams-section" *ngIf="isBeamsEnabled && BeamsDataForPricing && BeamsDataForPricing.length > 0">
                <div class="main-title">{{ 'modify-product.beams' | translate }}</div>
                
                <!-- אורכים נדרשים -->
                <div class="sub-title">{{ 'modify-product.required-lengths' | translate }}</div>
                <div class="materials-summary required-lengths-summary">
                    <div *ngFor="let beamData of BeamsDataForPricing" class="beam-name">
                        <!-- כותרת סוג הקורה -->
                        <div class="pricing-title">{{ beamData.beamTranslatedName || beamData.beamName }} ({{ beamData.type?.translatedName || beamData.beamWoodType }}) - קורת {{ getBeamLengthInMeters(beamData) }} {{ 'modify-product.beam-meter' | translate }}</div>
                        
                        <!-- רשימת המידות -->
                        <div *ngFor="let sizeData of beamData.totalSizes" class="size-item">
                            <span class="size-value">{{ sizeData.length }} {{ 'modify-product.cm' | translate }}</span>
                            <span class="size-separator"></span>
                            <span class="size-count">{{ sizeData.count }} {{ 'price-calculation.units' | translate }}</span>
                        </div>
                    </div>
                </div>
                
                <!-- סידור אופטימלי לחיתוך - רק אם חיתוך מופעל -->
                <div class="sub-title no-border" *ngIf="isCuttingEnabled">{{ 'modify-product.optimal-cutting-arrangement' | translate }}</div>
                <div class="materials-summary" *ngIf="cuttingPlan && cuttingPlan.length > 0">
                    <div *ngFor="let beam of cuttingPlan" class="beam-type-section">
                        <!-- כותרת קורה -->
                        <div class="beam-header">
                            <div class="beam-number">{{ beam.beamNumber }}</div>
                            <div class="beam-details-item">
                                <span class="beam-text">{{ beam.beamType }} ({{ beam.beamWoodType }}) {{ beam.beamLength }} ס"מ</span>
                                <span class="beam-separator" style="opacity: 0;"></span>
                                <span class="beam-price">{{ beam.beamPrice }}₪</span>
                            </div>
                        </div>
                        
                        <!-- רשימת החתיכות מקובצות לפי גודל -->
                        <div *ngFor="let cutGroup of getCutGroups(beam.cuts)" class="size-item">
                            <span class="size-value">{{ cutGroup.length }} {{ 'modify-product.cm' | translate }}</span>
                            <span class="size-separator"></span>
                            <span class="size-count">{{ cutGroup.count }} {{ 'price-calculation.units' | translate }}</span>
                        </div>
                    </div>
                </div>
                <div class="materials-summary" *ngIf="!cuttingPlan || cuttingPlan.length === 0">
                    <div class="thinking-text">{{ 'modify-product.calculating' | translate }}</div>
                </div>
            </div>
            
            <!-- ברגים - רק אם מופעלים -->
            <div class="screws-section" *ngIf="isScrewsEnabled && ForgingDataForPricing && ForgingDataForPricing.length > 0 && hasActiveScrews()">
                <div class="main-title">{{ 'modify-product.screws' | translate }}</div>
                
                <!-- אורכים נדרשים -->
                <div class="sub-title">{{ 'modify-product.required-lengths' | translate }}</div>
                <div class="materials-summary required-lengths-summary">
                    <div class="beam-type-section">
                        <div *ngFor="let forgingData of getActiveScrews()" class="size-item">
                            <span class="size-value">{{ forgingData.length }} {{ 'modify-product.cm' | translate }}</span>
                            <span class="size-separator"></span>
                            <span class="size-count">{{ forgingData.count }} {{ 'price-calculation.units' | translate }}</span>
                        </div>
                    </div>
                </div>
                
                <!-- קופסאות ברגים מומלצות - רק אם ברגים מופעלים -->
                <div class="sub-title" *ngIf="isScrewsEnabled && screwsPackagingPlan && screwsPackagingPlan.length > 0">{{ 'modify-product.recommended-screw-packages' | translate }}</div>
                <div class="materials-summary" *ngIf="screwsPackagingPlan && screwsPackagingPlan.length > 0">
                    <div *ngFor="let package of screwsPackagingPlan; let i = index" class="beam-type-section">
                        <!-- כותרת קופסא עם מספר -->
                        <div class="beam-header">
                            <div class="beam-number">{{ i + 1 }}</div>
                            <div class="beam-details-item">
                                <span class="beam-text">{{ package.screwTranslatedName }} - {{ package.optimalPackage.translatedName }}</span>
                                <span class="beam-separator" style="opacity: 0;"></span>
                                <span class="beam-price">{{ package.totalPrice }} ₪</span>
                            </div>
                        </div>
                        
                        <!-- פרטי הקופסא -->
                        <div class="size-item">
                            <span class="size-value">{{ package.optimalPackage.price }} ₪ × {{ package.numPackages }} יח'</span>
                            <span class="size-separator"></span>
                            <span class="size-count">{{ package.totalPrice }} ₪</span>
                        </div>
                    </div>
                        </div>
                    </div>
                </ng-container>
            </div>
            
        </div>
</div>